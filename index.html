<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>B√∫ssola do Gestor ¬∑ Instituto Salto</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üß≠</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet" />
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', system-ui, sans-serif; background: linear-gradient(160deg, #faf8f5 0%, #f0ede8 100%); min-height: 100vh; }
    #root { min-height: 100vh; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.4s ease both; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useMemo, useEffect, useRef } = React;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFIG ‚Äî altere aqui, nunca dentro do c√≥digo
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CONFIG = {
  APP_VERSION: "1.0.0",

  // FIX 3: ciclo_projeto adicionado ‚Äî formato "AAAA-TN" (ex: "2026-T1")
  // Altere a cada trimestre antes de redistribuir o arquivo
  CICLO_PROJETO: "2026-T1",

  // Backend ‚Äî cole a URL do seu Google Apps Script Web App aqui
  APPS_SCRIPT_URL: "https://script.google.com/macros/s/AKfycbyLjxEWsvEBonEgZaJ6m3q1oPGEWDSXXLA4_PAnNJnBTFm8lba_RBv82w5gJggb-CdM3A/exec",

  // FIX 1: Token enviado no body do payload (n√£o s√≥ no header)
  // Mesmo valor deve estar no Apps Script
  APP_TOKEN: "salto-bussola-2026",

  // Links din√¢micos ‚Äî altere os templates sem tocar no resto do c√≥digo
  // {COMP_ID} ser√° substitu√≠do pelo id da compet√™ncia com h√≠fen (ex.: "2-1")
  BASE_COMP_URL: "https://salto.org.br/bussola/competencias/{COMP_ID}",
  BASE_PORTFOLIO_URL: "https://salto.org.br/portfolio?email={EMAIL}",

  // Exibir faixas interpretativas do IMLE?
  // false = s√≥ n√∫mero + mensagem neutra (recomendado para V1)
  SHOW_IMLE_BANDS: false,

  IMLE_BANDS: [
    { max: 1.5, label: "Estrutura√ß√£o",        desc: "Voc√™ est√° nas etapas iniciais de desenvolvimento nessas compet√™ncias." },
    { max: 2.5, label: "Consolida√ß√£o",         desc: "Voc√™ demonstra avan√ßos consistentes e tem espa√ßo claro para crescer." },
    { max: 3.2, label: "Lideran√ßa avan√ßada",   desc: "Voc√™ j√° pratica essas compet√™ncias com autonomia e consist√™ncia." },
    { max: 4.0, label: "Refer√™ncia sist√™mica", desc: "Voc√™ est√° num patamar de refer√™ncia e tem muito a contribuir com outros gestores." },
  ],
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const normalizeEmail   = (e) => e.trim().toLowerCase();
const compIdToSlug     = (id) => id.replace(".", "-");
const buildCompLink    = (id)    => CONFIG.BASE_COMP_URL.replace("{COMP_ID}", compIdToSlug(id));
const buildPortfolioLink = (email) => CONFIG.BASE_PORTFOLIO_URL.replace("{EMAIL}", encodeURIComponent(normalizeEmail(email)));

function getImleInterpretation(imle) {
  for (const band of CONFIG.IMLE_BANDS) {
    if (imle <= band.max) return band;
  }
  return CONFIG.IMLE_BANDS[CONFIG.IMLE_BANDS.length - 1];
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function generateSubmissionId() {
  return "sub_" + Date.now() + "_" + Math.random().toString(36).slice(2, 9);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DADOS ‚Äî COMPET√äNCIAS P1, P2, P3
// Descritores extra√≠dos da Matriz v5.2 (Instituto Salto)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const COMPETENCIES = [
  {
    id: "1.1", dimension: "P1", dimensionName: "Prop√≥sito", weight: 2,
    name: "Conduz a escola com vis√£o clara e compartilhada",
    levels: [
      "Reconhe√ßo a import√¢ncia de uma vis√£o para a escola, mas ainda atuo de forma reativa, com pouca clareza sobre prioridades e sem envolver a equipe no planejamento.",
      "Comunico metas b√°sicas, defino algumas prioridades de forma mais expl√≠cita e come√ßo a envolver a equipe na revis√£o do PPP, ainda sem const√¢ncia ou sistematiza√ß√£o.",
      "Construo vis√£o clara com a comunidade, uso o PPP para orientar decis√µes, reviso prioridades com regularidade e mobilizo a equipe em torno de objetivos comuns.",
      "Minha escola tem vis√£o reconhecida na rede; sistematizo processos de participa√ß√£o e inspiro outras unidades a construir projetos consistentes e colaborativos.",
    ],
  },
  {
    id: "1.2", dimension: "P1", dimensionName: "Prop√≥sito", weight: 3,
    name: "Coloca a aprendizagem e o desenvolvimento integral no centro",
    levels: [
      "Reconhe√ßo os desafios de aprendizagem, mas ainda priorizo demandas administrativas acima das pedag√≥gicas.",
      "Dedico mais tempo √†s decis√µes pedag√≥gicas e come√ßo a usar dados b√°sicos para compreender resultados de aprendizagem.",
      "Organizo tempo e recursos para garantir foco pedag√≥gico; uso dados para orientar a√ß√µes; articulo acolhimento, inclus√£o e rigor acad√™mico.",
      "Sou reconhecido(a) por minha capacidade de orientar a escola para a aprendizagem com equidade e compartilho estrat√©gias com outras escolas e redes.",
    ],
  },
  {
    id: "1.3", dimension: "P1", dimensionName: "Prop√≥sito", weight: 2,
    name: "Age como l√≠der p√∫blico comprometido com o interesse coletivo",
    levels: [
      "Demonstro boa vontade, mas ainda enfrento dificuldades para tomar decis√µes transparentes e coerentes em contextos de press√£o.",
      "Busco justificativas t√©cnicas para decis√µes, comunico com mais clareza e come√ßo a fortalecer processos √©ticos junto √† equipe.",
      "Decido com integridade, justi√ßa e transpar√™ncia; lido com conflitos com firmeza; mantenho coer√™ncia entre discurso e pr√°tica.",
      "Torno-me exemplo de lideran√ßa √©tica na rede; oriento outros gestores; minhas pr√°ticas influenciam forma√ß√µes, diretrizes e pol√≠ticas de gest√£o.",
    ],
  },
  {
    id: "1.4", dimension: "P1", dimensionName: "Prop√≥sito", weight: 1,
    name: "Sustenta uma cultura de altas expectativas com acolhimento",
    levels: [
      "Demonstro preocupa√ß√£o com desempenho, mas comunico expectativas de forma irregular ou pouco alinhada ao apoio a estudantes e equipe.",
      "Passo a combinar exig√™ncia com apoio; refor√ßo metas; reconhe√ßo avan√ßos, ainda sem manter uma rotina consistente de acompanhamento.",
      "Construo cultura em que estudantes e profissionais se sentem apoiados e desafiados; uso feedback, reconhecimento e di√°logo para sustentar altas expectativas.",
      "Minha escola √© reconhecida pelo clima de altas expectativas e pertencimento; compartilho pr√°ticas que inspiram outras unidades a fortalecer sua cultura escolar.",
    ],
  },
  {
    id: "2.1", dimension: "P2", dimensionName: "Pedagogia", weight: 3,
    name: "Observa, acompanha e apoia o trabalho pedag√≥gico",
    levels: [
      "Realizo visitas de sala pontuais, geralmente motivadas por problemas. Ofere√ßo orienta√ß√µes gerais, ainda pouco conectadas √†s necessidades reais da pr√°tica docente.",
      "Organizo uma rotina b√°sica de observa√ß√£o e registro aspectos essenciais. Dou feedbacks mais espec√≠ficos e acolhedores, ainda sem acompanhamento sistem√°tico ao longo do tempo.",
      "Mantenho rotina consistente de observa√ß√µes; ofere√ßo feedback formativo claro, construtivo e baseado em evid√™ncias; acompanho planos pedag√≥gicos e apoio docentes em metas de desenvolvimento.",
      "Sistematizo pr√°ticas de acompanhamento usadas por outros gestores; formo pares; construo cultura de pr√°tica reflexiva sustentada por ciclos regulares de observa√ß√£o e feedback.",
    ],
  },
  {
    id: "2.2", dimension: "P2", dimensionName: "Pedagogia", weight: 3,
    name: "Usa dados de aprendizagem para orientar decis√µes",
    levels: [
      "Tenho acesso a dados, mas utilizo pouco. As decis√µes pedag√≥gicas ainda se baseiam mais em impress√µes do que em informa√ß√µes sistem√°ticas.",
      "Passo a analisar resultados b√°sicos do cotidiano pedag√≥gico (participa√ß√£o, avalia√ß√µes internas, frequ√™ncia) e come√ßo a relacion√°-los com pr√°ticas de sala de aula.",
      "Analiso diferentes fontes de dados pedag√≥gicos, identifico desigualdades de aprendizagem, cruzo indicadores, compartilho achados com a equipe e planejamos a√ß√µes focalizadas.",
      "Torno-me refer√™ncia no uso pedag√≥gico de dados; promovo forma√ß√µes sobre an√°lise de dados; inspiro e apoio outras escolas a implementarem estrat√©gias de monitoramento.",
    ],
  },
  {
    id: "2.3", dimension: "P2", dimensionName: "Pedagogia", weight: 2,
    name: "Promove forma√ß√£o docente cont√≠nua e relevante",
    levels: [
      "Organizo forma√ß√µes de forma reativa, baseadas em demandas emergenciais ou orienta√ß√µes externas, sem conex√£o clara com prioridades pedag√≥gicas.",
      "Planejo forma√ß√µes mais alinhadas ao PPP, identifico necessidades da equipe e come√ßo a integrar momentos de estudo e troca.",
      "Construo plano s√≥lido de forma√ß√£o cont√≠nua, articulo especialistas, promovo pr√°ticas colaborativas, conecto teoria e pr√°tica e garanto tempo protegido para aprender.",
      "Minha escola se torna polo de aprendizagem; sistematizo experi√™ncias formativas; participo de redes de desenvolvimento docente e influencio pol√≠ticas de forma√ß√£o.",
    ],
  },
  {
    id: "2.4", dimension: "P2", dimensionName: "Pedagogia", weight: 2,
    name: "Integra curr√≠culo, avalia√ß√£o e metodologias",
    levels: [
      "Reconhe√ßo documentos curriculares, mas a articula√ß√£o entre o que se ensina, como se ensina e como se avalia ainda √© pouco clara na escola.",
      "Estabele√ßo di√°logos mais frequentes com docentes sobre curr√≠culo e avalia√ß√£o; incentivo ajustes pontuais em metodologias.",
      "Crio coer√™ncia entre curr√≠culo, metodologias, tempos, espa√ßos e avalia√ß√µes; apoio o uso de instrumentos variados; garanto alinhamento entre planejamento e pr√°tica.",
      "Contribuo para revis√µes curriculares da rede; sistematizo pr√°ticas de integra√ß√£o; inspiro escolas a fortalecer coer√™ncia pedag√≥gica e foco em aprendizagens essenciais.",
    ],
  },
  {
    id: "2.5", dimension: "P2", dimensionName: "Pedagogia", weight: 2,
    name: "Articula estrat√©gias de inclus√£o e personaliza√ß√£o",
    levels: [
      "Reconhe√ßo a diversidade dos estudantes, mas apoio a√ß√µes inclusivas apenas de maneira pontual.",
      "Organizo adapta√ß√µes b√°sicas, inicio di√°logo com profissionais de apoio e identifico necessidades espec√≠ficas de grupos ou estudantes.",
      "Sustento planos articulados de inclus√£o (PAEs, AEE, adapta√ß√µes curriculares, acessibilidade); garanto participa√ß√£o de todos; apoio docentes a diferenciar estrat√©gias.",
      "Sou reconhecido(a) pela condu√ß√£o √©tica e eficaz de inclus√£o; compartilho pr√°ticas com a rede; formo docentes e gestores sobre atendimento, equidade e personaliza√ß√£o.",
    ],
  },
  {
    id: "3.1", dimension: "P3", dimensionName: "Pessoas", weight: 2,
    name: "Desenvolve e acompanha profissionais da escola",
    levels: [
      "Fa√ßo orienta√ß√µes pontuais, geralmente reativas. Ainda n√£o realizo conversas sistem√°ticas sobre desenvolvimento ou acompanhamento da pr√°tica.",
      "Organizo conversas individuais com alguns profissionais, defino metas b√°sicas e acompanho avan√ßos de maneira irregular, ainda com pouca sistematiza√ß√£o.",
      "Mantenho rotina de desenvolvimento profissional com toda a equipe; defino metas claras; ofere√ßo orienta√ß√£o espec√≠fica; registro avan√ßos e ajusto planos.",
      "Acompanho e desenvolvo equipes de forma inspiradora; formo outros gestores sobre coaching educacional; sistematizo pr√°ticas de acompanhamento usadas pela rede.",
    ],
  },
  {
    id: "3.2", dimension: "P3", dimensionName: "Pessoas", weight: 3,
    name: "Cultiva seguran√ßa psicol√≥gica e colabora√ß√£o",
    levels: [
      "Demonstro abertura ao di√°logo, mas ainda existe medo, sil√™ncio ou desconfian√ßa na equipe. Conflitos s√£o deixados de lado ou tratados superficialmente.",
      "Crio espa√ßos de fala e escuta, estabele√ßo rotinas b√°sicas de colabora√ß√£o e intervenho quando h√° tens√µes mais evidentes.",
      "Construo ambiente em que as pessoas dizem a verdade sem medo; incentivo colabora√ß√£o real; acolho vulnerabilidades; combato rumores e fofocas com pr√°ticas de transpar√™ncia.",
      "Minha escola √© reconhecida por ter clima saud√°vel e colaborativo; pr√°ticas de seguran√ßa psicol√≥gica tornam-se refer√™ncia; contribuo com forma√ß√µes sobre cultura organizacional.",
    ],
  },
  {
    id: "3.3", dimension: "P3", dimensionName: "Pessoas", weight: 2,
    name: "Enfrenta discrimina√ß√µes e conflitos com firmeza e justi√ßa",
    levels: [
      "Tenho boa inten√ß√£o, mas hesito em intervir diante de situa√ß√µes de racismo, machismo, LGBTfobia, ass√©dio ou viol√™ncia. Respostas ainda s√£o lentas ou pouco firmes.",
      "Enfrento discrimina√ß√µes com mais rapidez, procuro apoio da rede quando necess√°rio e comunico-me com mais clareza e firmeza.",
      "Intervenho com justi√ßa e firmeza sempre que h√° discrimina√ß√£o ou viol√™ncia; documento casos; aciono a rede de prote√ß√£o; protejo estudantes e profissionais com postura √©tica.",
      "Torno-me exemplo de atua√ß√£o √©tica; conduzo forma√ß√µes sobre conviv√™ncia e direitos; inspiro pol√≠ticas da rede e apoio outros gestores na condu√ß√£o de casos complexos.",
    ],
  },
  {
    id: "3.4", dimension: "P3", dimensionName: "Pessoas", weight: 1,
    name: "Organiza o trabalho com clareza e respeito",
    levels: [
      "Defino algumas tarefas, mas as expectativas s√£o amb√≠guas e a equipe tem d√∫vidas sobre pap√©is e responsabilidades.",
      "Melhoro a distribui√ß√£o de fun√ß√µes, estabele√ßo rotinas mais claras e come√ßo a ajustar pr√°ticas e fluxos de comunica√ß√£o.",
      "Garanto clareza de fun√ß√µes, processos, hor√°rios e rotinas; reduzo ambiguidades; facilito o trabalho pedag√≥gico; comunico decis√µes com transpar√™ncia.",
      "Sou reconhecido(a) por minha capacidade de estruturar equipes de forma eficiente e humana; apoio a rede a revisar pr√°ticas de organiza√ß√£o escolar.",
    ],
  },
  {
    id: "3.5", dimension: "P3", dimensionName: "Pessoas", weight: 1,
    name: "Promove bem-estar profissional e apoio m√∫tuo",
    levels: [
      "Reconhe√ßo dificuldades da equipe, mas ofere√ßo suporte de maneira informal e irregular.",
      "Adoto algumas pr√°ticas de apoio (momentos de escuta, encaminhamentos, ajustes de rotina) e crio espa√ßos de conviv√™ncia.",
      "Promovo cultura de apoio m√∫tuo; observo sinais de sobrecarga; equilibro demandas; organizo estrat√©gias preventivas de bem-estar.",
      "Torno-me refer√™ncia em sa√∫de ocupacional e bem-estar profissional; contribuo para pol√≠ticas de valoriza√ß√£o docente; inspiro outras escolas a adotarem pr√°ticas de apoio.",
    ],
  },
];

const LEVEL_LABELS = ["Inicial", "Em Desenvolvimento", "Avan√ßado", "Refer√™ncia"];
const DIMENSIONS   = ["P1", "P2", "P3"];
const DIM_COLORS   = { P1: "#c4955a", P2: "#5a7ec4", P3: "#6dab8c" };
const DIM_LABELS   = { P1: "Prop√≥sito", P2: "Pedagogia", P3: "Pessoas" };

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONTRADI√á√ïES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// Cada regra √© DIRECIONAL: a contradi√ß√£o s√≥ existe quando A est√° alto E B est√° baixo.
// L√≥gica: (va - vb >= diff) ‚Äî n√£o usamos Math.abs para evitar falso-positivo inverso.
// Exemplo: "Voc√™ promove forma√ß√£o (A alto) mas n√£o observa salas (B baixo)" faz sentido.
//          O inverso ("voc√™ observa mas n√£o faz forma√ß√£o") √© outra situa√ß√£o, sem mensagem.
const CONTRADICTION_RULES = [
  // A alto (aprendizagem no centro) + B baixo (pouco uso de dados) ‚Üí incoer√™ncia
  { a: "1.2", b: "2.2", diff: 2, msg: "Voc√™ coloca a aprendizagem no centro (1.2), mas ainda usa poucos dados para orientar decis√µes pedag√≥gicas (2.2). Como transformar essa inten√ß√£o em pr√°tica sistem√°tica?" },
  // A alto (acompanha salas) + B baixo (seguran√ßa psicol√≥gica fr√°gil) ‚Üí risco de clima ruim
  { a: "2.1", b: "3.2", diff: 2, msg: "Voc√™ acompanha bem o trabalho pedag√≥gico (2.1), mas a seguran√ßa psicol√≥gica da equipe ainda √© baixa (3.2). Observar mais pode gerar desconforto se a confian√ßa n√£o estiver estabelecida." },
  // A alto (seguran√ßa psicol√≥gica) + B baixo (hesita em enfrentar discrimina√ß√µes) ‚Üí contradi√ß√£o
  { a: "3.2", b: "3.3", diff: 2, msg: "Voc√™ cultiva seguran√ßa psicol√≥gica (3.2), mas ainda hesita em enfrentar discrimina√ß√µes com firmeza (3.3). Seguran√ßa real exige que todos saibam que conflitos s√©rios ser√£o tratados." },
  // A alto (faz forma√ß√£o docente) + B baixo (pouca observa√ß√£o) ‚Üí forma√ß√£o sem evid√™ncia
  { a: "2.3", b: "2.1", diff: 2, msg: "Voc√™ promove forma√ß√£o docente (2.3), mas o acompanhamento em sala ainda √© irregular (2.1). Forma√ß√£o sem observa√ß√£o tem menos impacto sobre a pr√°tica real." },
  // A alto (vis√£o clara) + B baixo (curr√≠culo desarticulado) ‚Üí prop√≥sito sem execu√ß√£o
  { a: "1.1", b: "2.4", diff: 2, msg: "Voc√™ constr√≥i vis√£o clara (1.1), mas a integra√ß√£o entre curr√≠culo, avalia√ß√£o e metodologias ainda √© fr√°gil (2.4). Uma escola com prop√≥sito claro precisa que esse prop√≥sito apare√ßa no que e como se ensina." },
  // A alto (organiza bem o trabalho) + B baixo (desenvolvimento irregular) ‚Üí estrutura sem desenvolvimento
  { a: "3.4", b: "3.1", diff: 2, msg: "Voc√™ organiza bem o trabalho (3.4), mas o desenvolvimento individual dos profissionais ainda √© irregular (3.1). Clareza de fun√ß√µes √© necess√°ria, mas n√£o substitui o acompanhamento da trajet√≥ria de cada um." },
  // A alto (l√≠der √©tico publicamente) + B baixo (hesita em casos internos) ‚Üí √©tica seletiva
  { a: "1.3", b: "3.3", diff: 2, msg: "Voc√™ se posiciona como l√≠der p√∫blico √©tico (1.3), mas ainda hesita diante de discrimina√ß√µes na equipe (3.3). Lideran√ßa √©tica se prova tamb√©m ‚Äî e sobretudo ‚Äî nos momentos de conflito interno." },
  // A alto (inclus√£o dos estudantes) + B baixo (seguran√ßa psicol√≥gica da equipe baixa) ‚Üí inclus√£o sem base
  { a: "2.5", b: "3.2", diff: 2, msg: "Voc√™ articula inclus√£o para os estudantes (2.5), mas a seguran√ßa psicol√≥gica da equipe ainda precisa crescer (3.2). Construir inclus√£o real exige um ambiente adulto tamb√©m seguro e colaborativo." },
];

function detectContradictions(answers) {
  const found = [];
  for (const rule of CONTRADICTION_RULES) {
    const va = answers[rule.a] ?? -1;
    const vb = answers[rule.b] ?? -1;
    if (va < 0 || vb < 0) continue;
    // DIRECIONAL: s√≥ dispara quando A est√° alto E B est√° baixo (va - vb >= diff)
    if (va - vb >= rule.diff) found.push(rule.msg);
  }
  return found;
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// C√ÅLCULOS
// Armazenamento interno: 0-3 (√≠ndice do n√≠vel)
// IMLE usa nivel_1a4 = raw + 1, escala 1-4
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function calcResults(answers) {
  const dimScores = {};
  let totalW = 0, totalWV = 0;

  for (const c of COMPETENCIES) {
    const raw = answers[c.id];
    if (raw === undefined || raw === null) continue;
    const nivel14 = raw + 1; // converte 0-3 para escala 1-4
    if (!dimScores[c.dimension]) dimScores[c.dimension] = { sumW: 0, sumWV: 0 };
    dimScores[c.dimension].sumW  += c.weight;
    dimScores[c.dimension].sumWV += nivel14 * c.weight;
    totalW  += c.weight;
    totalWV += nivel14 * c.weight;
  }

  const dims = {};
  for (const d of DIMENSIONS) {
    const s = dimScores[d];
    dims[d] = s ? s.sumWV / s.sumW : 0;
  }

  const imle = totalW > 0 ? totalWV / totalW : 0;
  return { dims, imle };
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SUBMIT
// token enviado no body (compat√≠vel com no-cors ‚Äî headers customizados
// causariam preflight e quebrariam o envio via GitHub Pages)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function submitToSheets(payload) {
  // mode: "no-cors" resolve redirecionamento CORS do Google Apps Script via GitHub Pages.
  // Resposta ser√° opaca (ileg√≠vel), mas o dado chega na planilha.
  // Valida√ß√£o real: checar nova linha na aba "respostas".
  await fetch(CONFIG.APPS_SCRIPT_URL, {
    method: "POST",
    mode: "no-cors",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify({
      token:                     CONFIG.APP_TOKEN,
      submission_id:             payload.submission_id,
      app_version:               payload.app_version,
      ciclo_projeto:             payload.ciclo_projeto,
      data_avaliacao:            payload.data_avaliacao,
      tipo_avaliacao:            payload.tipo_avaliacao,
      email:                     payload.email,
      nome:                      payload.nome,
      escola:                    payload.escola,
      rede:                      payload.rede,
      media_P1:                  payload.media_P1,
      media_P2:                  payload.media_P2,
      media_P3:                  payload.media_P3,
      IMLE:                      payload.IMLE,
      competencia_foco:          payload.competencia_foco,
      quer_ser_mentor:           payload.quer_ser_mentor,
      competencia_mentoria:      payload.competencia_mentoria,
      link_competencia_foco:     payload.link_competencia_foco,
      link_competencia_mentoria: payload.link_competencia_mentoria,
      link_portfolio:            payload.link_portfolio,
      answers:                   payload.answers_json,
    }),
  });
  // Com no-cors a resposta √© opaca ‚Äî sucesso = fetch n√£o lan√ßou erro de rede
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// RADAR SVG
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function RadarChart({ dims }) {
  const cx = 120, cy = 115, r = 85;
  const angles  = [-90, 30, 150]; // P1 topo, P2 inf-dir, P3 inf-esq
  const toRad   = (deg) => (deg * Math.PI) / 180;
  const maxVal  = 4;

  const points = DIMENSIONS.map((d, i) => {
    const angle = toRad(angles[i]);
    const val   = dims[d] || 0;
    const ratio = val / maxVal;
    return {
      x: cx + r * ratio * Math.cos(angle),
      y: cy + r * ratio * Math.sin(angle),
      lx: cx + (r + 22) * Math.cos(angle),
      ly: cy + (r + 22) * Math.sin(angle),
      dim: d, val,
    };
  });

  const polyPts   = points.map((p) => `${p.x},${p.y}`).join(" ");
  const gridLevels = [1, 2, 3, 4];

  return (
    <svg viewBox="0 0 240 230" style={{ width: "100%", maxWidth: 280, display: "block", margin: "0 auto" }}>
      {gridLevels.map((lv) => {
        const gPts = DIMENSIONS.map((_, i) => {
          const angle = toRad(angles[i]);
          const ratio = lv / maxVal;
          return `${cx + r * ratio * Math.cos(angle)},${cy + r * ratio * Math.sin(angle)}`;
        }).join(" ");
        return <polygon key={lv} points={gPts} fill="none" stroke="#ddd9d4" strokeWidth="1" />;
      })}
      {DIMENSIONS.map((_, i) => {
        const angle = toRad(angles[i]);
        return <line key={i} x1={cx} y1={cy} x2={cx + r * Math.cos(angle)} y2={cy + r * Math.sin(angle)} stroke="#ddd9d4" strokeWidth="1" />;
      })}
      <polygon points={polyPts} fill="rgba(196,149,90,0.15)" stroke="#c4955a" strokeWidth="2" strokeLinejoin="round" />
      {points.map((p) => <circle key={p.dim} cx={p.x} cy={p.y} r="4" fill={DIM_COLORS[p.dim]} />)}
      {points.map((p) => (
        <text key={p.dim} x={p.lx} y={p.ly + 4} textAnchor="middle" fontSize="11" fontFamily="DM Sans" fill="#5a5550" fontWeight="600">
          {p.dim} {p.val.toFixed(1)}
        </text>
      ))}
    </svg>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ESTILOS COMPARTILHADOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const S = {
  wrap:     { minHeight: "100vh", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "flex-start", padding: "24px 16px 48px" },
  card:     { width: "100%", maxWidth: 560, backgroundColor: "#fff", borderRadius: 20, padding: "32px 28px", boxShadow: "0 2px 24px rgba(45,41,38,0.07)", border: "1px solid #e8e4df", marginTop: 16 },
  h1:       { fontFamily: "'DM Serif Display', serif", fontSize: 26, color: "#2d2926", lineHeight: 1.25, margin: "0 0 8px" },
  h2:       { fontFamily: "'DM Serif Display', serif", fontSize: 20, color: "#2d2926", margin: "0 0 14px" },
  sub:      { fontSize: 14, color: "#8a8580", lineHeight: 1.6, margin: "0 0 20px" },
  label:    { fontSize: 13, fontWeight: 600, color: "#5a5550", display: "block", marginBottom: 6 },
  input:    { width: "100%", padding: "10px 14px", borderRadius: 10, border: "1.5px solid #e0ddd8", fontSize: 14, fontFamily: "'DM Sans', sans-serif", color: "#2d2926", outline: "none", background: "#fff", marginBottom: 14 },
  btn:      { display: "block", width: "100%", padding: "14px 20px", borderRadius: 12, border: "none", backgroundColor: "#c4955a", color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans', sans-serif", marginTop: 8 },
  btnGhost: { display: "block", width: "100%", padding: "11px 20px", borderRadius: 12, border: "1.5px solid #e0ddd8", backgroundColor: "transparent", color: "#8a8580", fontSize: 14, fontWeight: 500, cursor: "pointer", fontFamily: "'DM Sans', sans-serif", marginTop: 8 },
  tag:      (color) => ({ display: "inline-block", padding: "2px 9px", borderRadius: 20, fontSize: 11, fontWeight: 700, backgroundColor: color + "22", color: color, marginBottom: 8 }),
  barWrap:  { background: "#f0ede8", borderRadius: 6, height: 8, flex: 1, overflow: "hidden" },
  bar:      (pct, color) => ({ width: `${pct}%`, height: "100%", background: color, borderRadius: 6, transition: "width 0.6s ease" }),
  infoBox:  (bg, border) => ({ background: bg, border: `1px solid ${border}`, borderRadius: 12, padding: "14px 16px", marginBottom: 12 }),
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// BANNER DE ENVIO PENDENTE
// FIX 2: verifica localStorage ao carregar e oferece reenvio
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function PendingBanner({ onDismiss }) {
  const [status, setStatus] = useState("idle");

  const retry = async () => {
    const raw = localStorage.getItem("pending_submission");
    if (!raw) { onDismiss(); return; }
    setStatus("sending");
    try {
      await submitToSheets(JSON.parse(raw));
      localStorage.removeItem("pending_submission");
      setStatus("success");
      setTimeout(onDismiss, 2000);
    } catch {
      setStatus("error");
    }
  };

  return (
    <div style={{ position: "fixed", top: 0, left: 0, right: 0, zIndex: 100,
      background: "#fff9f0", borderBottom: "2px solid #f0d9a8", padding: "12px 20px",
      display: "flex", alignItems: "center", gap: 12, flexWrap: "wrap" }}>
      <span style={{ fontSize: 13, color: "#7a5a2a", flex: 1 }}>
        ‚ö†Ô∏è Voc√™ tem uma avalia√ß√£o que n√£o foi enviada. Deseja reenviar agora?
      </span>
      {status === "success" && <span style={{ fontSize: 13, color: "#2a7a50", fontWeight: 600 }}>‚úì Enviado!</span>}
      {status === "error"   && <span style={{ fontSize: 13, color: "#c04040" }}>Falhou. Tente novamente.</span>}
      {status !== "success" && (
        <>
          <button onClick={retry} disabled={status === "sending"}
            style={{ padding: "7px 14px", borderRadius: 8, border: "none", background: "#c4955a", color: "#fff",
              fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "'DM Sans', sans-serif" }}>
            {status === "sending" ? "Enviando‚Ä¶" : "Reenviar"}
          </button>
          <button onClick={() => { localStorage.removeItem("pending_submission"); onDismiss(); }}
            style={{ padding: "7px 14px", borderRadius: 8, border: "1px solid #e0ddd8", background: "transparent",
              color: "#8a8580", fontSize: 13, cursor: "pointer", fontFamily: "'DM Sans', sans-serif" }}>
            Descartar
          </button>
        </>
      )}
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TELA DE BOAS-VINDAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function WelcomeScreen({ onStart }) {
  const [form, setForm] = useState({ nome: "", email: "", escola: "", rede: "", tipo: "AUTO" });
  const [err,  setErr]  = useState("");

  const set = (k) => (e) => setForm((f) => ({ ...f, [k]: e.target.value }));

  const handleStart = () => {
    if (!form.nome.trim())  { setErr("Por favor, informe seu nome."); return; }
    if (!form.email.trim() || !form.email.includes("@")) { setErr("Informe um e-mail v√°lido."); return; }
    if (!form.escola.trim()) { setErr("Informe o nome da escola."); return; }
    if (!form.rede.trim())   { setErr("Informe a rede/munic√≠pio."); return; }
    setErr("");
    onStart(form);
  };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={{ ...S.card, paddingTop: 28 }}>
        <div style={{ textAlign: "center", marginBottom: 20 }}>
          <div style={{ fontSize: 40, marginBottom: 4 }}>üß≠</div>
          <div style={{ fontSize: 11, fontWeight: 700, letterSpacing: 2, color: "#c4955a", textTransform: "uppercase", marginBottom: 8 }}>Instituto Salto</div>
          <h1 style={S.h1}>B√∫ssola do Gestor</h1>
          <p style={{ ...S.sub, marginBottom: 0 }}>Autoavalia√ß√£o de compet√™ncias da Matriz 7 Ps</p>
        </div>

        <div style={{ borderTop: "1px solid #f0ede8", margin: "20px 0" }} />

        <div style={S.infoBox("#fdf9f4", "#e8dfd0")}>
          <p style={{ fontSize: 13, color: "#6a6560", lineHeight: 1.75, margin: 0 }}>
            <strong style={{ color: "#5a5550" }}>O que √© isso?</strong><br />
            A B√∫ssola do Gestor √© uma ferramenta pessoal de desenvolvimento ‚Äî n√£o √© uma avalia√ß√£o, uma prova ou um ranking. Ela foi constru√≠da com base na Matriz de Compet√™ncias de Gestores Escolares do Instituto Salto para te ajudar a enxergar com clareza onde voc√™ est√° hoje e onde quer chegar.<br /><br />
            <strong style={{ color: "#5a5550" }}>Como funciona?</strong><br />
            Voc√™ vai ler descri√ß√µes de pr√°tica real e escolher aquela que melhor representa o que voc√™ <em>de fato</em> faz ‚Äî n√£o o que gostaria de fazer ou o que acha que deveria fazer. Ao final, voc√™ escolhe uma compet√™ncia para desenvolver e pode se oferecer como mentor(a) de colegas em algo que j√° domina (uma atividade volunt√°ria com dura√ß√£o de 3 a 6 horas por m√™s e certifica√ß√£o).<br /><br />
            <strong style={{ color: "#5a5550" }}>Por que a honestidade importa?</strong><br />
            Quanto mais fiel ao que voc√™ realmente vive na escola, mais √∫til ser√° o resultado. Ningu√©m vai ver sua resposta para te julgar. Isso √© para voc√™.
          </p>
        </div>

        <div style={{ borderTop: "1px solid #f0ede8", margin: "20px 0 16px" }} />

        <label style={S.label}>Nome completo *</label>
        <input style={S.input} placeholder="Seu nome" value={form.nome} onChange={set("nome")} />

        <label style={S.label}>E-mail institucional *</label>
        <input style={S.input} type="email" placeholder="seu@email.com.br" value={form.email} onChange={set("email")} />

        <label style={S.label}>Escola *</label>
        <input style={S.input} placeholder="Nome da escola" value={form.escola} onChange={set("escola")} />

        <label style={S.label}>Rede / Munic√≠pio *</label>
        <input style={S.input} placeholder="Ex.: Porto Alegre/RS" value={form.rede} onChange={set("rede")} />

        <label style={S.label}>Tipo de avalia√ß√£o</label>
        <select style={S.input} value={form.tipo} onChange={set("tipo")}>
          <option value="AUTO">Autoavalia√ß√£o</option>
          <option value="360">Avalia√ß√£o 360 (por pares/supervis√£o)</option>
        </select>

        {err && <p style={{ color: "#c44", fontSize: 13, marginBottom: 10 }}>{err}</p>}

        <button style={S.btn} onClick={handleStart}>Come√ßar a avalia√ß√£o ‚Üí</button>
        <p style={{ fontSize: 12, color: "#b0aba6", textAlign: "center", marginTop: 14 }}>
          14 compet√™ncias ¬∑ ~10 minutos ¬∑ suas respostas ser√£o usadas exclusivamente para fins formativos no programa
        </p>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TELA DE PERGUNTAS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function QuestionScreen({ onFinish }) {
  const [current, setCurrent] = useState(0);
  const [answers, setAnswers] = useState({});

  const comp     = COMPETENCIES[current];
  const shuffled = useMemo(() => shuffle([0, 1, 2, 3]), [comp.id]);
  const progress = ((current + 1) / COMPETENCIES.length) * 100;

  const choose = (idx) => {
    const newAns = { ...answers, [comp.id]: idx };
    setAnswers(newAns);
    setTimeout(() => {
      if (current < COMPETENCIES.length - 1) setCurrent(current + 1);
      else onFinish(newAns);
    }, 180);
  };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <div style={{ marginBottom: 16 }}>
          <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, color: "#b0aba6", marginBottom: 6 }}>
            <span>{current + 1} de {COMPETENCIES.length}</span>
            <span>{Math.round(progress)}%</span>
          </div>
          <div style={{ background: "#f0ede8", borderRadius: 6, height: 5, overflow: "hidden" }}>
            <div style={{ width: `${progress}%`, height: "100%", background: DIM_COLORS[comp.dimension], transition: "width 0.4s ease", borderRadius: 6 }} />
          </div>
        </div>

        <div style={S.tag(DIM_COLORS[comp.dimension])}>{comp.dimension} ¬∑ {comp.dimensionName}</div>
        <h2 style={{ ...S.h2, marginBottom: 6 }}>{comp.name}</h2>
        <p style={{ fontSize: 13, color: "#b0aba6", marginBottom: 20 }}>Escolha o descritor que melhor representa sua pr√°tica atual.</p>

        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          {shuffled.map((lvlIdx) => {
            const isSelected = answers[comp.id] === lvlIdx;
            return (
              <button key={lvlIdx} onClick={() => choose(lvlIdx)} style={{
                display: "flex", gap: 12, alignItems: "flex-start", textAlign: "left",
                padding: "14px 16px", borderRadius: 12, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                border: isSelected ? `2px solid ${DIM_COLORS[comp.dimension]}` : "1.5px solid #e8e4df",
                background: isSelected ? DIM_COLORS[comp.dimension] + "11" : "#fff",
                transition: "all 0.15s",
              }}>
                <span style={{ fontSize: 14, color: "#4a4540", lineHeight: 1.6 }}>{comp.levels[lvlIdx]}</span>
              </button>
            );
          })}
        </div>

        {current > 0 && (
          <button style={S.btnGhost} onClick={() => setCurrent(current - 1)}>‚Üê Voltar</button>
        )}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TELA DE RESULTADOS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ResultsScreen({ answers, userData, onDecide }) {
  const { dims, imle }  = useMemo(() => calcResults(answers), [answers]);
  const contradictions  = useMemo(() => detectContradictions(answers), [answers]);
  const interpretation  = getImleInterpretation(imle);

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <div style={{ textAlign: "center", marginBottom: 20 }}>
          <div style={{ fontSize: 36, marginBottom: 4 }}>üß≠</div>
          <h2 style={S.h2}>Seu resultado</h2>
          <p style={{ fontSize: 13, color: "#8a8580" }}>{userData.nome} ¬∑ {userData.escola}</p>
        </div>

        {/* IMLE */}
        <div style={{ ...S.infoBox("#fdf9f4", "#e8dfd0"), textAlign: "center", marginBottom: 16 }}>
          <p style={{ fontSize: 11, fontWeight: 700, letterSpacing: 1.5, textTransform: "uppercase", color: "#c4955a", marginBottom: 4 }}>
            IMLE ‚Äî √çndice de Maturidade de Lideran√ßa Escolar
          </p>
          <div style={{ fontSize: 38, fontWeight: 700, color: "#2d2926", fontFamily: "'DM Serif Display', serif", lineHeight: 1 }}>
            {imle.toFixed(1)}{" "}
            <span style={{ fontSize: 18, color: "#b0aba6", fontFamily: "'DM Sans', sans-serif", fontWeight: 400 }}>/ 4,0</span>
          </div>
          {CONFIG.SHOW_IMLE_BANDS && (
            <div style={{ marginTop: 6 }}>
              <span style={S.tag("#c4955a")}>{interpretation.label}</span>
            </div>
          )}
          <p style={{ fontSize: 13, color: "#6a6560", marginTop: 8, lineHeight: 1.55 }}>
            {CONFIG.SHOW_IMLE_BANDS ? interpretation.desc
              : imle >= 3.3 ? "Voc√™ est√° num patamar avan√ßado de lideran√ßa. H√° espa√ßo para se tornar refer√™ncia sist√™mica."
              : imle >= 2.6 ? "Voc√™ demonstra pr√°ticas consistentes e tem espa√ßo claro para aprofundar sua lideran√ßa."
              : imle >= 1.6 ? "Voc√™ est√° em desenvolvimento e j√° acumulou experi√™ncias valiosas. Foco em algumas compet√™ncias pode acelerar seu crescimento."
              : "Voc√™ est√° nas etapas iniciais dessas compet√™ncias ‚Äî um bom ponto de partida para um plano de desenvolvimento focado."}
          </p>
        </div>

        {/* Radar */}
        <div style={{ marginBottom: 16 }}>
          <RadarChart dims={dims} />
        </div>

        {/* Barras por dimens√£o */}
        {DIMENSIONS.map((d) => {
          const comps = COMPETENCIES.filter((c) => c.dimension === d);
          return (
            <div key={d} style={{ marginBottom: 20 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 8 }}>
                <span style={S.tag(DIM_COLORS[d])}>{d}</span>
                <span style={{ fontWeight: 600, fontSize: 14, color: "#2d2926" }}>{DIM_LABELS[d]}</span>
                <span style={{ marginLeft: "auto", fontSize: 13, fontWeight: 700, color: DIM_COLORS[d] }}>{(dims[d] || 0).toFixed(1)}</span>
              </div>
              {comps.map((c) => {
                const v   = answers[c.id] ?? -1;
                const pct = v >= 0 ? ((v + 1) / 4) * 100 : 0;
                return (
                  <div key={c.id} style={{ marginBottom: 8 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, color: "#6a6560", marginBottom: 3 }}>
                      <span>{c.id} ¬∑ {c.name}</span>
                      <span style={{ fontWeight: 600, flexShrink: 0, marginLeft: 8 }}>{v >= 0 ? LEVEL_LABELS[v] : "‚Äî"}</span>
                    </div>
                    <div style={S.barWrap}><div style={S.bar(pct, DIM_COLORS[d])} /></div>
                  </div>
                );
              })}
            </div>
          );
        })}

        {/* Contradi√ß√µes */}
        {contradictions.length > 0 && (
          <div style={{ marginTop: 8 }}>
            <p style={{ fontSize: 13, fontWeight: 700, color: "#b07a3a", marginBottom: 8 }}>üí° Pontos para reflex√£o</p>
            {contradictions.map((msg, i) => (
              <div key={i} style={S.infoBox("#fff9f0", "#f0d9a8")}>
                <p style={{ fontSize: 13, color: "#7a5a2a", lineHeight: 1.6, margin: 0 }}>{msg}</p>
              </div>
            ))}
          </div>
        )}

        <button style={{ ...S.btn, marginTop: 20 }} onClick={onDecide}>Escolher minha compet√™ncia-foco ‚Üí</button>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TELA DE DECIS√ïES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function DecisionScreen({ answers, userData, results, onConfirm }) {
  const [focus,      setFocus]      = useState(null);
  const [mentor,     setMentor]     = useState(null);
  const [mentorComp, setMentorComp] = useState(null);
  const [err,        setErr]        = useState("");

  // Ordena√ß√£o: n√≠vel mais baixo primeiro; dentro do mesmo n√≠vel, fundantes (weight 3) sobem.
  // Fallback gradual: expande para o pr√≥ximo n√≠vel at√© ter 3 compet√™ncias.
  const focusComps = useMemo(() => {
    const sorted = [...COMPETENCIES].sort((a, b) => {
      const la = answers[a.id] ?? 0;
      const lb = answers[b.id] ?? 0;
      if (la !== lb) return la - lb;               // menor n√≠vel primeiro
      return b.weight - a.weight;                  // fundantes (weight 3) sobem
    });
    const minLevel = sorted[0] ? (answers[sorted[0].id] ?? 0) : 0;
    let result = [];
    let level = minLevel;
    while (result.length < 3 && level <= 3) {
      const atLevel = sorted.filter(c => (answers[c.id] ?? 0) === level);
      result = [...result, ...atLevel];
      level++;
    }
    return result.slice(0, 3);
  }, [answers]);

  const highComps = COMPETENCIES.filter((c) => (answers[c.id] ?? -1) >= 2);

  const handleConfirm = () => {
    if (!focus)             { setErr("Escolha uma compet√™ncia-foco para continuar."); return; }
    if (mentor === null)    { setErr("Indique se deseja ser mentor(a)."); return; }
    if (mentor && !mentorComp) { setErr("Escolha a compet√™ncia em que voc√™ vai oferecer mentoria."); return; }
    setErr("");
    onConfirm({
      focus, mentor, mentorComp,
      linkFocus:     buildCompLink(focus),
      linkMentor:    mentor && mentorComp ? buildCompLink(mentorComp) : "",
      linkPortfolio: buildPortfolioLink(userData.email),
    });
  };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <h2 style={S.h2}>Suas decis√µes de desenvolvimento</h2>
        <p style={S.sub}>Com base no que voc√™ respondeu, defina seu pr√≥ximo passo.</p>

        {/* Compet√™ncia foco */}
        <div style={{ marginBottom: 24 }}>
          <p style={{ fontSize: 14, fontWeight: 600, color: "#2d2926", marginBottom: 4 }}>
            Qual compet√™ncia voc√™ quer desenvolver primeiro? *
          </p>
          <p style={{ fontSize: 13, color: "#8a8580", marginBottom: 12 }}>
            As compet√™ncias abaixo est√£o na ordem em que acreditamos que deveriam ser priorizadas,
            considerando seu perfil. As marcadas com ‚òÖ s√£o fundantes ‚Äî estruturam as demais.
          </p>
          <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
            {focusComps.map((c) => (
              <button key={c.id} onClick={() => setFocus(c.id)} style={{
                display: "flex", gap: 10, alignItems: "center", textAlign: "left",
                padding: "12px 14px", borderRadius: 10, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                border: focus === c.id ? `2px solid ${DIM_COLORS[c.dimension]}` : "1.5px solid #e8e4df",
                background: focus === c.id ? DIM_COLORS[c.dimension] + "11" : "#fff",
                transition: "all 0.15s",
              }}>
                <span style={{ ...S.tag(DIM_COLORS[c.dimension]), margin: 0, flexShrink: 0 }}>{c.id}</span>
                <span style={{ fontSize: 13, color: "#4a4540", lineHeight: 1.5 }}>
                  {c.weight === 3 && <span style={{ color: "#c4955a", marginRight: 4 }}>‚òÖ</span>}
                  {c.name} <span style={{ color: "#b0aba6", marginLeft: 4 }}>({LEVEL_LABELS[answers[c.id] ?? 0]})</span>
                </span>
              </button>
            ))}
          </div>
        </div>

        {/* Mentoria */}
        <div style={{ marginBottom: 24 }}>
          <p style={{ fontSize: 14, fontWeight: 600, color: "#2d2926", marginBottom: 4 }}>Voc√™ quer se candidatar a mentor(a)? *</p>
          <p style={{ fontSize: 13, color: "#8a8580", marginBottom: 12 }}>
            Gestores com n√≠vel Avan√ßado ou Refer√™ncia em alguma compet√™ncia podem apoiar colegas.
          </p>
          <div style={{ display: "flex", gap: 10 }}>
            {["Sim", "N√£o"].map((opt) => {
              const val = opt === "Sim";
              return (
                <button key={opt} onClick={() => { setMentor(val); if (!val) setMentorComp(null); }} style={{
                  flex: 1, padding: "11px", borderRadius: 10, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                  fontWeight: 600, fontSize: 14,
                  border: mentor === val ? "2px solid #c4955a" : "1.5px solid #e8e4df",
                  background: mentor === val ? "#c4955a11" : "#fff",
                  color: mentor === val ? "#c4955a" : "#6a6560",
                  transition: "all 0.15s",
                }}>
                  {opt}
                </button>
              );
            })}
          </div>

          {mentor === true && (
            <div style={{ marginTop: 14 }}>
              <p style={{ fontSize: 13, fontWeight: 600, color: "#5a5550", marginBottom: 8 }}>Em qual compet√™ncia voc√™ vai oferecer mentoria? *</p>
              <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                {(highComps.length > 0 ? highComps : COMPETENCIES).map((c) => (
                  <button key={c.id} onClick={() => setMentorComp(c.id)} style={{
                    display: "flex", gap: 10, alignItems: "center", textAlign: "left",
                    padding: "11px 14px", borderRadius: 10, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                    border: mentorComp === c.id ? `2px solid ${DIM_COLORS[c.dimension]}` : "1.5px solid #e8e4df",
                    background: mentorComp === c.id ? DIM_COLORS[c.dimension] + "11" : "#fff",
                    transition: "all 0.15s",
                  }}>
                    <span style={{ ...S.tag(DIM_COLORS[c.dimension]), margin: 0, flexShrink: 0 }}>{c.id}</span>
                    <span style={{ fontSize: 13, color: "#4a4540" }}>
                      {c.name} <span style={{ color: "#b0aba6", marginLeft: 4 }}>({LEVEL_LABELS[answers[c.id] ?? 0]})</span>
                    </span>
                  </button>
                ))}
              </div>
            </div>
          )}
        </div>

        {err && <p style={{ color: "#c44", fontSize: 13, marginBottom: 10 }}>{err}</p>}
        <button style={S.btn} onClick={handleConfirm}>Confirmar e enviar ‚Üí</button>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// TELA DE CONFIRMA√á√ÉO
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ConfirmationScreen({ userData, answers, results, decisions }) {
  const { imle, dims } = results;
  const [status,  setStatus]  = useState("idle");
  const [errMsg,  setErrMsg]  = useState("");
  const submittedRef = useRef(false);

  // FIX 2: ciclo_projeto + alinhamento de nomes de campos com o Apps Script
  const buildPayload = () => ({
    submission_id:           generateSubmissionId(),
    app_version:             CONFIG.APP_VERSION,
    ciclo_projeto:           CONFIG.CICLO_PROJETO,
    nome:                    userData.nome,
    email:                   normalizeEmail(userData.email),
    escola:                  userData.escola,
    rede:                    userData.rede,
    tipo_avaliacao:          userData.tipo,
    data_avaliacao:          new Date().toISOString().slice(0, 10),
    media_P1:                parseFloat(dims.P1.toFixed(2)),
    media_P2:                parseFloat(dims.P2.toFixed(2)),
    media_P3:                parseFloat(dims.P3.toFixed(2)),
    IMLE:                    parseFloat(imle.toFixed(2)),
    competencia_foco:        decisions.focus,
    quer_ser_mentor:         decisions.mentor,
    competencia_mentoria:    decisions.mentorComp || "",
    link_competencia_foco:   decisions.linkFocus,
    link_competencia_mentoria: decisions.linkMentor,
    link_portfolio:          decisions.linkPortfolio,
    answers_json:            JSON.stringify(answers),
  });

  const doSubmit = async () => {
    if (submittedRef.current) return;
    submittedRef.current = true;
    setStatus("sending");
    const payload = buildPayload();
    try {
      await submitToSheets(payload);
      localStorage.removeItem("pending_submission");
      setStatus("success");
    } catch (e) {
      submittedRef.current = false;
      setErrMsg("N√£o foi poss√≠vel enviar agora. Suas respostas foram salvas neste dispositivo.");
      localStorage.setItem("pending_submission", JSON.stringify(payload));
      setStatus("error");
    }
  };

  const retry = () => { submittedRef.current = false; doSubmit(); };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <div style={{ textAlign: "center", marginBottom: 20 }}>
          <div style={{ fontSize: 40, marginBottom: 8 }}>
            {status === "success" ? "‚úÖ" : status === "error" ? "‚ö†Ô∏è" : status === "sending" ? "‚è≥" : "üìã"}
          </div>
          <h2 style={S.h2}>
            {status === "success" ? "Enviado com sucesso!" : status === "error" ? "Erro no envio" : status === "sending" ? "Enviando‚Ä¶" : "Resumo da sua avalia√ß√£o"}
          </h2>
        </div>

        {/* Resumo */}
        <div style={S.infoBox("#f5f8ff", "#d0daf0")}>
          <p style={{ fontSize: 13, color: "#4a4560", lineHeight: 1.7, margin: 0 }}>
            <strong>IMLE:</strong> {imle.toFixed(1)} / 4,0<br />
            <strong>P1:</strong> {dims.P1.toFixed(1)} ¬∑ <strong>P2:</strong> {dims.P2.toFixed(1)} ¬∑ <strong>P3:</strong> {dims.P3.toFixed(1)}<br />
            <strong>Compet√™ncia-foco:</strong> {decisions.focus} ¬∑ {COMPETENCIES.find(c => c.id === decisions.focus)?.name}<br />
            {decisions.mentor && <><strong>Mentoria em:</strong> {decisions.mentorComp} ¬∑ {COMPETENCIES.find(c => c.id === decisions.mentorComp)?.name}<br /></>}
            <strong>Ciclo:</strong> {CONFIG.CICLO_PROJETO} ¬∑ <strong>Tipo:</strong> {userData.tipo === "AUTO" ? "Autoavalia√ß√£o" : "Avalia√ß√£o 360"}
          </p>
        </div>

        {/* Links de desenvolvimento */}
        <div style={{ marginTop: 16, marginBottom: 8 }}>
          <p style={{ fontSize: 13, fontWeight: 600, color: "#5a5550", marginBottom: 10 }}>Seus materiais de desenvolvimento:</p>
          <a href={decisions.linkFocus} target="_blank" rel="noreferrer" style={{
            display: "block", padding: "12px 16px", borderRadius: 10, background: "#c4955a", color: "#fff",
            textDecoration: "none", fontSize: 13, fontWeight: 600, marginBottom: 8, textAlign: "center",
          }}>üìò Unidade digital: Compet√™ncia {decisions.focus}</a>

          {decisions.mentor && decisions.mentorComp && (
            <a href={decisions.linkMentor} target="_blank" rel="noreferrer" style={{
              display: "block", padding: "12px 16px", borderRadius: 10, background: "#6dab8c", color: "#fff",
              textDecoration: "none", fontSize: 13, fontWeight: 600, marginBottom: 8, textAlign: "center",
            }}>ü§ù Compet√™ncia de mentoria: {decisions.mentorComp}</a>
          )}

          <a href={decisions.linkPortfolio} target="_blank" rel="noreferrer" style={{
            display: "block", padding: "12px 16px", borderRadius: 10, border: "1.5px solid #e0ddd8",
            color: "#5a7ec4", textDecoration: "none", fontSize: 13, fontWeight: 600, textAlign: "center",
          }}>üóÇÔ∏è Meu portf√≥lio digital</a>
        </div>

        {/* Bot√£o de envio */}
        {status === "idle" && (
          <button style={{ ...S.btn, marginTop: 12 }} onClick={doSubmit}>Confirmar e registrar minha avalia√ß√£o</button>
        )}
        {status === "sending" && (
          <button style={{ ...S.btn, marginTop: 12, opacity: 0.6, cursor: "not-allowed" }} disabled>Enviando‚Ä¶</button>
        )}
        {status === "error" && (
          <div style={{ marginTop: 12 }}>
            <div style={S.infoBox("#fff5f5", "#f0c0c0")}>
              <p style={{ fontSize: 13, color: "#c04040", margin: 0 }}>{errMsg}</p>
            </div>
            <button style={S.btn} onClick={retry}>Tentar novamente</button>
          </div>
        )}
        {status === "success" && (
          <div style={S.infoBox("#f0fff8", "#a0e0c0")}>
            <p style={{ fontSize: 13, color: "#2a7a50", margin: 0, lineHeight: 1.6 }}>
              ‚úì Suas respostas foram registradas. A pr√≥xima avalia√ß√£o sugerida √© em 3 meses (ciclo {CONFIG.CICLO_PROJETO}).
            </p>
          </div>
        )}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APP PRINCIPAL
// FIX 2: verifica pending_submission ao inicializar
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function App() {
  const [screen,    setScreen]    = useState("welcome");
  const [userData,  setUserData]  = useState(null);
  const [answers,   setAnswers]   = useState({});
  const [results,   setResults]   = useState(null);
  const [decisions, setDecisions] = useState(null);
  const [showPending, setShowPending] = useState(false);

  useEffect(() => {
    if (localStorage.getItem("pending_submission")) setShowPending(true);
  }, []);

  const handleStart = (form) => { setUserData(form); setScreen("questions"); };

  const handleFinishQuestions = (ans) => {
    setAnswers(ans);
    setResults(calcResults(ans));
    setScreen("results");
  };

  const handleDecide = (dec) => { setDecisions(dec); setScreen("confirmation"); };

  return (
    <>
      {showPending && <PendingBanner onDismiss={() => setShowPending(false)} />}
      <div style={showPending ? { paddingTop: 60 } : {}}>
        {screen === "welcome"      && <WelcomeScreen onStart={handleStart} />}
        {screen === "questions"    && <QuestionScreen onFinish={handleFinishQuestions} />}
        {screen === "results"      && <ResultsScreen answers={answers} userData={userData} results={results} onDecide={() => setScreen("decisions")} />}
        {screen === "decisions"    && <DecisionScreen answers={answers} userData={userData} results={results} onConfirm={handleDecide} />}
        {screen === "confirmation" && <ConfirmationScreen userData={userData} answers={answers} results={results} decisions={decisions} />}
      </div>
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
