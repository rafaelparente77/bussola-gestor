<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BÃºssola do Gestor Â· Instituto Salto</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ§­</text></svg>">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet" />
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', system-ui, sans-serif; background: linear-gradient(160deg, #faf8f5 0%, #f0ede8 100%); min-height: 100vh; }
    #root { min-height: 100vh; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.4s ease both; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useMemo, useEffect, useRef } = React;

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFIG â€” altere aqui, nunca dentro do cÃ³digo
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CONFIG = {
  APP_VERSION: "1.0.0",
  CICLO_PROJETO: "2026-T1",
  APPS_SCRIPT_URL: "https://script.google.com/macros/s/AKfycbyLjxEWsvEBonEgZaJ6m3q1oPGEWDSXXLA4_PAnNJnBTFm8lba_RBv82w5gJggb-CdM3A/exec",
  APP_TOKEN: "salto-bussola-2026",
  BASE_COMP_URL: "https://salto.org.br/bussola/competencias/{COMP_ID}",
  BASE_PORTFOLIO_URL: "https://salto.org.br/portfolio?email={EMAIL}",
  SHOW_IMLE_BANDS: false,
  IMLE_BANDS: [
    { max: 1.5, label: "EstruturaÃ§Ã£o",        desc: "VocÃª estÃ¡ nas etapas iniciais de desenvolvimento nessas competÃªncias." },
    { max: 2.5, label: "ConsolidaÃ§Ã£o",         desc: "VocÃª demonstra avanÃ§os consistentes e tem espaÃ§o claro para crescer." },
    { max: 3.2, label: "LideranÃ§a avanÃ§ada",   desc: "VocÃª jÃ¡ pratica essas competÃªncias com autonomia e consistÃªncia." },
    { max: 4.0, label: "ReferÃªncia sistÃªmica", desc: "VocÃª estÃ¡ num patamar de referÃªncia e tem muito a contribuir com outros gestores." },
  ],
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const normalizeEmail    = (e) => e.trim().toLowerCase();
const compIdToSlug      = (id) => id.replace(".", "-");
const buildCompLink     = (id)    => CONFIG.BASE_COMP_URL.replace("{COMP_ID}", compIdToSlug(id));
const buildPortfolioLink = (email) => CONFIG.BASE_PORTFOLIO_URL.replace("{EMAIL}", encodeURIComponent(normalizeEmail(email)));

function getImleInterpretation(imle) {
  for (const band of CONFIG.IMLE_BANDS) {
    if (imle <= band.max) return band;
  }
  return CONFIG.IMLE_BANDS[CONFIG.IMLE_BANDS.length - 1];
}

function shuffle(arr) {
  const a = [...arr];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function generateSubmissionId() {
  return "sub_" + Date.now() + "_" + Math.random().toString(36).slice(2, 9);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPETÃŠNCIAS P1, P2, P3 â€” Matriz v5.2
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const COMPETENCIES = [
  {
    id: "1.1", dimension: "P1", dimensionName: "PropÃ³sito", weight: 2,
    name: "Conduz a escola com visÃ£o clara e compartilhada",
    levels: [
      "ReconheÃ§o a importÃ¢ncia de uma visÃ£o para a escola, mas ainda atuo de forma reativa, com pouca clareza sobre prioridades e sem envolver a equipe no planejamento.",
      "Comunico metas bÃ¡sicas, defino algumas prioridades de forma mais explÃ­cita e comeÃ§o a envolver a equipe na revisÃ£o do PPP, ainda sem constÃ¢ncia ou sistematizaÃ§Ã£o.",
      "Construo visÃ£o clara com a comunidade, uso o PPP para orientar decisÃµes, reviso prioridades com regularidade e mobilizo a equipe em torno de objetivos comuns.",
      "Minha escola tem visÃ£o reconhecida na rede; sistematizo processos de participaÃ§Ã£o e inspiro outras unidades a construir projetos consistentes e colaborativos.",
    ],
  },
  {
    id: "1.2", dimension: "P1", dimensionName: "PropÃ³sito", weight: 3,
    name: "Coloca a aprendizagem e o desenvolvimento integral no centro",
    levels: [
      "ReconheÃ§o os desafios de aprendizagem, mas ainda priorizo demandas administrativas acima das pedagÃ³gicas.",
      "Dedico mais tempo Ã s decisÃµes pedagÃ³gicas e comeÃ§o a usar dados bÃ¡sicos para compreender resultados de aprendizagem.",
      "Organizo tempo e recursos para garantir foco pedagÃ³gico; uso dados para orientar aÃ§Ãµes; articulo acolhimento, inclusÃ£o e rigor acadÃªmico.",
      "Sou reconhecido(a) por minha capacidade de orientar a escola para a aprendizagem com equidade e compartilho estratÃ©gias com outras escolas e redes.",
    ],
  },
  {
    id: "1.3", dimension: "P1", dimensionName: "PropÃ³sito", weight: 2,
    name: "Age como lÃ­der pÃºblico comprometido com o interesse coletivo",
    levels: [
      "Demonstro boa vontade, mas ainda enfrento dificuldades para tomar decisÃµes transparentes e coerentes em contextos de pressÃ£o.",
      "Busco justificativas tÃ©cnicas para decisÃµes, comunico com mais clareza e comeÃ§o a fortalecer processos Ã©ticos junto Ã  equipe.",
      "Decido com integridade, justiÃ§a e transparÃªncia; lido com conflitos com firmeza; mantenho coerÃªncia entre discurso e prÃ¡tica.",
      "Torno-me exemplo de lideranÃ§a Ã©tica na rede; oriento outros gestores; minhas prÃ¡ticas influenciam formaÃ§Ãµes, diretrizes e polÃ­ticas de gestÃ£o.",
    ],
  },
  {
    id: "1.4", dimension: "P1", dimensionName: "PropÃ³sito", weight: 1,
    name: "Sustenta uma cultura de altas expectativas com acolhimento",
    levels: [
      "Demonstro preocupaÃ§Ã£o com desempenho, mas comunico expectativas de forma irregular ou pouco alinhada ao apoio a estudantes e equipe.",
      "Passo a combinar exigÃªncia com apoio; reforÃ§o metas; reconheÃ§o avanÃ§os, ainda sem manter uma rotina consistente de acompanhamento.",
      "Construo cultura em que estudantes e profissionais se sentem apoiados e desafiados; uso feedback, reconhecimento e diÃ¡logo para sustentar altas expectativas.",
      "Minha escola Ã© reconhecida pelo clima de altas expectativas e pertencimento; compartilho prÃ¡ticas que inspiram outras unidades a fortalecer sua cultura escolar.",
    ],
  },
  {
    id: "2.1", dimension: "P2", dimensionName: "Pedagogia", weight: 3,
    name: "Observa, acompanha e apoia o trabalho pedagÃ³gico",
    levels: [
      "Realizo visitas de sala pontuais, geralmente motivadas por problemas. OfereÃ§o orientaÃ§Ãµes gerais, ainda pouco conectadas Ã s necessidades reais da prÃ¡tica docente.",
      "Organizo uma rotina bÃ¡sica de observaÃ§Ã£o e registro aspectos essenciais. Dou feedbacks mais especÃ­ficos e acolhedores, ainda sem acompanhamento sistemÃ¡tico ao longo do tempo.",
      "Mantenho rotina consistente de observaÃ§Ãµes; ofereÃ§o feedback formativo claro, construtivo e baseado em evidÃªncias; acompanho planos pedagÃ³gicos e apoio docentes em metas de desenvolvimento.",
      "Sistematizo prÃ¡ticas de acompanhamento usadas por outros gestores; formo pares; construo cultura de prÃ¡tica reflexiva sustentada por ciclos regulares de observaÃ§Ã£o e feedback.",
    ],
  },
  {
    id: "2.2", dimension: "P2", dimensionName: "Pedagogia", weight: 3,
    name: "Usa dados de aprendizagem para orientar decisÃµes",
    levels: [
      "Tenho acesso a dados, mas utilizo pouco. As decisÃµes pedagÃ³gicas ainda se baseiam mais em impressÃµes do que em informaÃ§Ãµes sistemÃ¡ticas.",
      "Passo a analisar resultados bÃ¡sicos do cotidiano pedagÃ³gico (participaÃ§Ã£o, avaliaÃ§Ãµes internas, frequÃªncia) e comeÃ§o a relacionÃ¡-los com prÃ¡ticas de sala de aula.",
      "Analiso diferentes fontes de dados pedagÃ³gicos, identifico desigualdades de aprendizagem, cruzo indicadores, compartilho achados com a equipe e planejamos aÃ§Ãµes focalizadas.",
      "Torno-me referÃªncia no uso pedagÃ³gico de dados; promovo formaÃ§Ãµes sobre anÃ¡lise de dados; inspiro e apoio outras escolas a implementarem estratÃ©gias de monitoramento.",
    ],
  },
  {
    id: "2.3", dimension: "P2", dimensionName: "Pedagogia", weight: 2,
    name: "Promove formaÃ§Ã£o docente contÃ­nua e relevante",
    levels: [
      "Organizo formaÃ§Ãµes de forma reativa, baseadas em demandas emergenciais ou orientaÃ§Ãµes externas, sem conexÃ£o clara com prioridades pedagÃ³gicas.",
      "Planejo formaÃ§Ãµes mais alinhadas ao PPP, identifico necessidades da equipe e comeÃ§o a integrar momentos de estudo e troca.",
      "Construo plano sÃ³lido de formaÃ§Ã£o contÃ­nua, articulo especialistas, promovo prÃ¡ticas colaborativas, conecto teoria e prÃ¡tica e garanto tempo protegido para aprender.",
      "Minha escola se torna polo de aprendizagem; sistematizo experiÃªncias formativas; participo de redes de desenvolvimento docente e influencio polÃ­ticas de formaÃ§Ã£o.",
    ],
  },
  {
    id: "2.4", dimension: "P2", dimensionName: "Pedagogia", weight: 2,
    name: "Integra currÃ­culo, avaliaÃ§Ã£o e metodologias",
    levels: [
      "ReconheÃ§o documentos curriculares, mas a articulaÃ§Ã£o entre o que se ensina, como se ensina e como se avalia ainda Ã© pouco clara na escola.",
      "EstabeleÃ§o diÃ¡logos mais frequentes com docentes sobre currÃ­culo e avaliaÃ§Ã£o; incentivo ajustes pontuais em metodologias.",
      "Crio coerÃªncia entre currÃ­culo, metodologias, tempos, espaÃ§os e avaliaÃ§Ãµes; apoio o uso de instrumentos variados; garanto alinhamento entre planejamento e prÃ¡tica.",
      "Contribuo para revisÃµes curriculares da rede; sistematizo prÃ¡ticas de integraÃ§Ã£o; inspiro escolas a fortalecer coerÃªncia pedagÃ³gica e foco em aprendizagens essenciais.",
    ],
  },
  {
    id: "2.5", dimension: "P2", dimensionName: "Pedagogia", weight: 2,
    name: "Articula estratÃ©gias de inclusÃ£o e personalizaÃ§Ã£o",
    levels: [
      "ReconheÃ§o a diversidade dos estudantes, mas apoio aÃ§Ãµes inclusivas apenas de maneira pontual.",
      "Organizo adaptaÃ§Ãµes bÃ¡sicas, inicio diÃ¡logo com profissionais de apoio e identifico necessidades especÃ­ficas de grupos ou estudantes.",
      "Sustento planos articulados de inclusÃ£o (PAEs, AEE, adaptaÃ§Ãµes curriculares, acessibilidade); garanto participaÃ§Ã£o de todos; apoio docentes a diferenciar estratÃ©gias.",
      "Sou reconhecido(a) pela conduÃ§Ã£o Ã©tica e eficaz de inclusÃ£o; compartilho prÃ¡ticas com a rede; formo docentes e gestores sobre atendimento, equidade e personalizaÃ§Ã£o.",
    ],
  },
  {
    id: "3.1", dimension: "P3", dimensionName: "Pessoas", weight: 2,
    name: "Desenvolve e acompanha profissionais da escola",
    levels: [
      "FaÃ§o orientaÃ§Ãµes pontuais, geralmente reativas. Ainda nÃ£o realizo conversas sistemÃ¡ticas sobre desenvolvimento ou acompanhamento da prÃ¡tica.",
      "Organizo conversas individuais com alguns profissionais, defino metas bÃ¡sicas e acompanho avanÃ§os de maneira irregular, ainda com pouca sistematizaÃ§Ã£o.",
      "Mantenho rotina de desenvolvimento profissional com toda a equipe; defino metas claras; ofereÃ§o orientaÃ§Ã£o especÃ­fica; registro avanÃ§os e ajusto planos.",
      "Acompanho e desenvolvo equipes de forma inspiradora; formo outros gestores sobre coaching educacional; sistematizo prÃ¡ticas de acompanhamento usadas pela rede.",
    ],
  },
  {
    id: "3.2", dimension: "P3", dimensionName: "Pessoas", weight: 3,
    name: "Cultiva seguranÃ§a psicolÃ³gica e colaboraÃ§Ã£o",
    levels: [
      "Demonstro abertura ao diÃ¡logo, mas ainda existe medo, silÃªncio ou desconfianÃ§a na equipe. Conflitos sÃ£o deixados de lado ou tratados superficialmente.",
      "Crio espaÃ§os de fala e escuta, estabeleÃ§o rotinas bÃ¡sicas de colaboraÃ§Ã£o e intervenho quando hÃ¡ tensÃµes mais evidentes.",
      "Construo ambiente em que as pessoas dizem a verdade sem medo; incentivo colaboraÃ§Ã£o real; acolho vulnerabilidades; combato rumores e fofocas com prÃ¡ticas de transparÃªncia.",
      "Minha escola Ã© reconhecida por ter clima saudÃ¡vel e colaborativo; prÃ¡ticas de seguranÃ§a psicolÃ³gica tornam-se referÃªncia; contribuo com formaÃ§Ãµes sobre cultura organizacional.",
    ],
  },
  {
    id: "3.3", dimension: "P3", dimensionName: "Pessoas", weight: 2,
    name: "Enfrenta discriminaÃ§Ãµes e conflitos com firmeza e justiÃ§a",
    levels: [
      "Tenho boa intenÃ§Ã£o, mas hesito em intervir diante de situaÃ§Ãµes de racismo, machismo, LGBTfobia, assÃ©dio ou violÃªncia. Respostas ainda sÃ£o lentas ou pouco firmes.",
      "Enfrento discriminaÃ§Ãµes com mais rapidez, procuro apoio da rede quando necessÃ¡rio e comunico-me com mais clareza e firmeza.",
      "Intervenho com justiÃ§a e firmeza sempre que hÃ¡ discriminaÃ§Ã£o ou violÃªncia; documento casos; aciono a rede de proteÃ§Ã£o; protejo estudantes e profissionais com postura Ã©tica.",
      "Torno-me exemplo de atuaÃ§Ã£o Ã©tica; conduzo formaÃ§Ãµes sobre convivÃªncia e direitos; inspiro polÃ­ticas da rede e apoio outros gestores na conduÃ§Ã£o de casos complexos.",
    ],
  },
  {
    id: "3.4", dimension: "P3", dimensionName: "Pessoas", weight: 1,
    name: "Organiza o trabalho com clareza e respeito",
    levels: [
      "Defino algumas tarefas, mas as expectativas sÃ£o ambÃ­guas e a equipe tem dÃºvidas sobre papÃ©is e responsabilidades.",
      "Melhoro a distribuiÃ§Ã£o de funÃ§Ãµes, estabeleÃ§o rotinas mais claras e comeÃ§o a ajustar prÃ¡ticas e fluxos de comunicaÃ§Ã£o.",
      "Garanto clareza de funÃ§Ãµes, processos, horÃ¡rios e rotinas; reduzo ambiguidades; facilito o trabalho pedagÃ³gico; comunico decisÃµes com transparÃªncia.",
      "Sou reconhecido(a) por minha capacidade de estruturar equipes de forma eficiente e humana; apoio a rede a revisar prÃ¡ticas de organizaÃ§Ã£o escolar.",
    ],
  },
  {
    id: "3.5", dimension: "P3", dimensionName: "Pessoas", weight: 1,
    name: "Promove bem-estar profissional e apoio mÃºtuo",
    levels: [
      "ReconheÃ§o dificuldades da equipe, mas ofereÃ§o suporte de maneira informal e irregular.",
      "Adoto algumas prÃ¡ticas de apoio (momentos de escuta, encaminhamentos, ajustes de rotina) e crio espaÃ§os de convivÃªncia.",
      "Promovo cultura de apoio mÃºtuo; observo sinais de sobrecarga; equilibro demandas; organizo estratÃ©gias preventivas de bem-estar.",
      "Torno-me referÃªncia em saÃºde ocupacional e bem-estar profissional; contribuo para polÃ­ticas de valorizaÃ§Ã£o docente; inspiro outras escolas a adotarem prÃ¡ticas de apoio.",
    ],
  },
];

const LEVEL_LABELS = ["Inicial", "Em Desenvolvimento", "AvanÃ§ado", "ReferÃªncia"];
const DIMENSIONS   = ["P1", "P2", "P3"];
const DIM_COLORS   = { P1: "#c4955a", P2: "#5a7ec4", P3: "#6dab8c" };
const DIM_LABELS   = { P1: "PropÃ³sito", P2: "Pedagogia", P3: "Pessoas" };

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONTRADIÃ‡Ã•ES â€” direcionais (va - vb >= diff)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const CONTRADICTION_RULES = [
  { a: "1.2", b: "2.2", diff: 2, msg: "VocÃª coloca a aprendizagem no centro (1.2), mas ainda usa poucos dados para orientar decisÃµes pedagÃ³gicas (2.2). Como transformar essa intenÃ§Ã£o em prÃ¡tica sistemÃ¡tica?" },
  { a: "2.1", b: "3.2", diff: 2, msg: "VocÃª acompanha bem o trabalho pedagÃ³gico (2.1), mas a seguranÃ§a psicolÃ³gica da equipe ainda Ã© baixa (3.2). Observar mais pode gerar desconforto se a confianÃ§a nÃ£o estiver estabelecida." },
  { a: "3.2", b: "3.3", diff: 2, msg: "VocÃª cultiva seguranÃ§a psicolÃ³gica (3.2), mas ainda hesita em enfrentar discriminaÃ§Ãµes com firmeza (3.3). SeguranÃ§a real exige que todos saibam que conflitos sÃ©rios serÃ£o tratados." },
  { a: "2.3", b: "2.1", diff: 2, msg: "VocÃª promove formaÃ§Ã£o docente (2.3), mas o acompanhamento em sala ainda Ã© irregular (2.1). FormaÃ§Ã£o sem observaÃ§Ã£o tem menos impacto sobre a prÃ¡tica real." },
  { a: "1.1", b: "2.4", diff: 2, msg: "VocÃª constrÃ³i visÃ£o clara (1.1), mas a integraÃ§Ã£o entre currÃ­culo, avaliaÃ§Ã£o e metodologias ainda Ã© frÃ¡gil (2.4). Uma escola com propÃ³sito claro precisa que esse propÃ³sito apareÃ§a no que e como se ensina." },
  { a: "3.4", b: "3.1", diff: 2, msg: "VocÃª organiza bem o trabalho (3.4), mas o desenvolvimento individual dos profissionais ainda Ã© irregular (3.1). Clareza de funÃ§Ãµes Ã© necessÃ¡ria, mas nÃ£o substitui o acompanhamento da trajetÃ³ria de cada um." },
  { a: "1.3", b: "3.3", diff: 2, msg: "VocÃª se posiciona como lÃ­der pÃºblico Ã©tico (1.3), mas ainda hesita diante de discriminaÃ§Ãµes na equipe (3.3). LideranÃ§a Ã©tica se prova tambÃ©m â€” e sobretudo â€” nos momentos de conflito interno." },
  { a: "2.5", b: "3.2", diff: 2, msg: "VocÃª articula inclusÃ£o para os estudantes (2.5), mas a seguranÃ§a psicolÃ³gica da equipe ainda precisa crescer (3.2). Construir inclusÃ£o real exige um ambiente adulto tambÃ©m seguro e colaborativo." },
];

function detectContradictions(answers) {
  const found = [];
  for (const rule of CONTRADICTION_RULES) {
    const va = answers[rule.a] ?? -1;
    const vb = answers[rule.b] ?? -1;
    if (va < 0 || vb < 0) continue;
    if (va - vb >= rule.diff) found.push(rule.msg);
  }
  return found;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CÃLCULOS â€” IMLE escala 1-4
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function calcResults(answers) {
  const dimScores = {};
  let totalW = 0, totalWV = 0;
  for (const c of COMPETENCIES) {
    const raw = answers[c.id];
    if (raw === undefined || raw === null) continue;
    const nivel14 = raw + 1;
    if (!dimScores[c.dimension]) dimScores[c.dimension] = { sumW: 0, sumWV: 0 };
    dimScores[c.dimension].sumW  += c.weight;
    dimScores[c.dimension].sumWV += nivel14 * c.weight;
    totalW  += c.weight;
    totalWV += nivel14 * c.weight;
  }
  const dims = {};
  for (const d of DIMENSIONS) {
    const s = dimScores[d];
    dims[d] = s ? s.sumWV / s.sumW : 0;
  }
  return { dims, imle: totalW > 0 ? totalWV / totalW : 0 };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SUBMIT â€” text/plain;charset=utf-8 evita preflight CORS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function submitToSheets(payload) {
  const res = await fetch(CONFIG.APPS_SCRIPT_URL, {
    method: "POST",
    headers: { "Content-Type": "text/plain;charset=utf-8" },
    body: JSON.stringify({
      token:                     CONFIG.APP_TOKEN,
      submission_id:             payload.submission_id,
      app_version:               payload.app_version,
      ciclo_projeto:             payload.ciclo_projeto,
      data_avaliacao:            payload.data_avaliacao,
      tipo_avaliacao:            payload.tipo_avaliacao,
      email:                     payload.email,
      nome:                      payload.nome,
      escola:                    payload.escola,
      rede:                      payload.rede,
      media_P1:                  payload.media_P1,
      media_P2:                  payload.media_P2,
      media_P3:                  payload.media_P3,
      IMLE:                      payload.IMLE,
      competencia_foco:          payload.competencia_foco,
      quer_ser_mentor:           payload.quer_ser_mentor,
      competencia_mentoria:      payload.competencia_mentoria,
      link_competencia_foco:     payload.link_competencia_foco,
      link_competencia_mentoria: payload.link_competencia_mentoria,
      link_portfolio:            payload.link_portfolio,
      answers:                   payload.answers_json,
    }),
  });
  if (!res.ok) throw new Error(`HTTP ${res.status}`);
  const json = JSON.parse(await res.text());
  if (json.ok === false) throw new Error(json.error || "Erro no servidor");
  return json;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// RADAR SVG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function RadarChart({ dims }) {
  const cx = 120, cy = 115, r = 85;
  const angles = [-90, 30, 150];
  const toRad  = (deg) => (deg * Math.PI) / 180;

  const points = DIMENSIONS.map((d, i) => {
    const angle = toRad(angles[i]);
    const val   = dims[d] || 0;
    const ratio = val / 4;
    return {
      x: cx + r * ratio * Math.cos(angle),
      y: cy + r * ratio * Math.sin(angle),
      lx: cx + (r + 22) * Math.cos(angle),
      ly: cy + (r + 22) * Math.sin(angle),
      dim: d, val,
    };
  });

  const polyPts = points.map((p) => `${p.x},${p.y}`).join(" ");

  return (
    <svg viewBox="0 0 240 230" style={{ width: "100%", maxWidth: 280, display: "block", margin: "0 auto" }}>
      {[1,2,3,4].map((lv) => {
        const gPts = DIMENSIONS.map((_, i) => {
          const angle = toRad(angles[i]);
          const ratio = lv / 4;
          return `${cx + r * ratio * Math.cos(angle)},${cy + r * ratio * Math.sin(angle)}`;
        }).join(" ");
        return <polygon key={lv} points={gPts} fill="none" stroke="#ddd9d4" strokeWidth="1" />;
      })}
      {DIMENSIONS.map((_, i) => {
        const angle = toRad(angles[i]);
        return <line key={i} x1={cx} y1={cy} x2={cx + r * Math.cos(angle)} y2={cy + r * Math.sin(angle)} stroke="#ddd9d4" strokeWidth="1" />;
      })}
      <polygon points={polyPts} fill="rgba(196,149,90,0.15)" stroke="#c4955a" strokeWidth="2" strokeLinejoin="round" />
      {points.map((p) => <circle key={p.dim} cx={p.x} cy={p.y} r="4" fill={DIM_COLORS[p.dim]} />)}
      {points.map((p) => (
        <text key={p.dim} x={p.lx} y={p.ly + 4} textAnchor="middle" fontSize="11" fontFamily="DM Sans" fill="#5a5550" fontWeight="600">
          {p.dim} {p.val.toFixed(1)}
        </text>
      ))}
    </svg>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ESTILOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const S = {
  wrap:     { minHeight: "100vh", display: "flex", flexDirection: "column", alignItems: "center", justifyContent: "flex-start", padding: "24px 16px 48px" },
  card:     { width: "100%", maxWidth: 560, backgroundColor: "#fff", borderRadius: 20, padding: "32px 28px", boxShadow: "0 2px 24px rgba(45,41,38,0.07)", border: "1px solid #e8e4df", marginTop: 16 },
  h1:       { fontFamily: "'DM Serif Display', serif", fontSize: 26, color: "#2d2926", lineHeight: 1.25, margin: "0 0 8px" },
  h2:       { fontFamily: "'DM Serif Display', serif", fontSize: 20, color: "#2d2926", margin: "0 0 14px" },
  sub:      { fontSize: 14, color: "#8a8580", lineHeight: 1.6, margin: "0 0 20px" },
  label:    { fontSize: 13, fontWeight: 600, color: "#5a5550", display: "block", marginBottom: 6 },
  input:    { width: "100%", padding: "10px 14px", borderRadius: 10, border: "1.5px solid #e0ddd8", fontSize: 14, fontFamily: "'DM Sans', sans-serif", color: "#2d2926", outline: "none", background: "#fff", marginBottom: 14 },
  btn:      { display: "block", width: "100%", padding: "14px 20px", borderRadius: 12, border: "none", backgroundColor: "#c4955a", color: "#fff", fontSize: 15, fontWeight: 700, cursor: "pointer", fontFamily: "'DM Sans', sans-serif", marginTop: 8 },
  btnGhost: { display: "block", width: "100%", padding: "11px 20px", borderRadius: 12, border: "1.5px solid #e0ddd8", backgroundColor: "transparent", color: "#8a8580", fontSize: 14, fontWeight: 500, cursor: "pointer", fontFamily: "'DM Sans', sans-serif", marginTop: 8 },
  tag:      (color) => ({ display: "inline-block", padding: "2px 9px", borderRadius: 20, fontSize: 11, fontWeight: 700, backgroundColor: color + "22", color: color, marginBottom: 8 }),
  barWrap:  { background: "#f0ede8", borderRadius: 6, height: 8, flex: 1, overflow: "hidden" },
  bar:      (pct, color) => ({ width: `${pct}%`, height: "100%", background: color, borderRadius: 6, transition: "width 0.6s ease" }),
  infoBox:  (bg, border) => ({ background: bg, border: `1px solid ${border}`, borderRadius: 12, padding: "14px 16px", marginBottom: 12 }),
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BANNER DE ENVIO PENDENTE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function PendingBanner({ onDismiss }) {
  const [status, setStatus] = useState("idle");

  const retry = async () => {
    const raw = localStorage.getItem("pending_submission");
    if (!raw) { onDismiss(); return; }
    setStatus("sending");
    try {
      await submitToSheets(JSON.parse(raw));
      localStorage.removeItem("pending_submission");
      setStatus("success");
      setTimeout(onDismiss, 2000);
    } catch {
      setStatus("error");
    }
  };

  return (
    <div style={{ position: "fixed", top: 0, left: 0, right: 0, zIndex: 100,
      background: "#fff9f0", borderBottom: "2px solid #f0d9a8", padding: "12px 20px",
      display: "flex", alignItems: "center", gap: 12, flexWrap: "wrap" }}>
      <span style={{ fontSize: 13, color: "#7a5a2a", flex: 1 }}>
        âš ï¸ VocÃª tem uma avaliaÃ§Ã£o que nÃ£o foi enviada. Deseja reenviar agora?
      </span>
      {status === "success" && <span style={{ fontSize: 13, color: "#2a7a50", fontWeight: 600 }}>âœ“ Enviado!</span>}
      {status === "error"   && <span style={{ fontSize: 13, color: "#c04040" }}>Falhou. Tente novamente.</span>}
      {status !== "success" && (
        <>
          <button onClick={retry} disabled={status === "sending"}
            style={{ padding: "7px 14px", borderRadius: 8, border: "none", background: "#c4955a", color: "#fff",
              fontSize: 13, fontWeight: 600, cursor: "pointer", fontFamily: "'DM Sans', sans-serif" }}>
            {status === "sending" ? "Enviandoâ€¦" : "Reenviar"}
          </button>
          <button onClick={() => { localStorage.removeItem("pending_submission"); onDismiss(); }}
            style={{ padding: "7px 14px", borderRadius: 8, border: "1px solid #e0ddd8", background: "transparent",
              color: "#8a8580", fontSize: 13, cursor: "pointer", fontFamily: "'DM Sans', sans-serif" }}>
            Descartar
          </button>
        </>
      )}
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELA DE BOAS-VINDAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function WelcomeScreen({ onStart }) {
  const [form, setForm] = useState({ nome: "", email: "", escola: "", rede: "", tipo: "AUTO" });
  const [err,  setErr]  = useState("");
  const set = (k) => (e) => setForm((f) => ({ ...f, [k]: e.target.value }));

  const handleStart = () => {
    if (!form.nome.trim())  { setErr("Por favor, informe seu nome."); return; }
    if (!form.email.trim() || !form.email.includes("@")) { setErr("Informe um e-mail vÃ¡lido."); return; }
    if (!form.escola.trim()) { setErr("Informe o nome da escola."); return; }
    if (!form.rede.trim())   { setErr("Informe a rede/municÃ­pio."); return; }
    setErr("");
    onStart(form);
  };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={{ ...S.card, paddingTop: 28 }}>
        <div style={{ textAlign: "center", marginBottom: 20 }}>
          <div style={{ fontSize: 40, marginBottom: 4 }}>ğŸ§­</div>
          <div style={{ fontSize: 11, fontWeight: 700, letterSpacing: 2, color: "#c4955a", textTransform: "uppercase", marginBottom: 8 }}>Instituto Salto</div>
          <h1 style={S.h1}>BÃºssola do Gestor</h1>
          <p style={{ ...S.sub, marginBottom: 0 }}>AutoavaliaÃ§Ã£o de competÃªncias da Matriz 7 Ps</p>
        </div>
        <div style={{ borderTop: "1px solid #f0ede8", margin: "20px 0" }} />
        <div style={S.infoBox("#fdf9f4", "#e8dfd0")}>
          <p style={{ fontSize: 13, color: "#6a6560", lineHeight: 1.65, margin: 0 }}>
            <strong style={{ color: "#5a5550" }}>O que Ã©:</strong> Uma ferramenta formativa baseada na Matriz de CompetÃªncias de Gestores Escolares (v5.2) do Instituto Salto, cobrindo PropÃ³sito, Pedagogia e Pessoas.<br /><br />
            <strong style={{ color: "#5a5550" }}>Para que serve:</strong> Ajudar vocÃª a identificar onde estÃ¡, escolher uma Ã¡rea de foco e, se quiser, oferecer sua experiÃªncia como mentor(a) de colegas.<br /><br />
            <strong style={{ color: "#5a5550" }}>Honestidade importa:</strong> NÃ£o hÃ¡ resposta certa. Quanto mais honesto(a) vocÃª for, mais Ãºtil serÃ¡ o resultado.
          </p>
        </div>
        <div style={{ borderTop: "1px solid #f0ede8", margin: "20px 0 16px" }} />
        <label style={S.label}>Nome completo *</label>
        <input style={S.input} placeholder="Seu nome" value={form.nome} onChange={set("nome")} />
        <label style={S.label}>E-mail institucional *</label>
        <input style={S.input} type="email" placeholder="seu@email.com.br" value={form.email} onChange={set("email")} />
        <label style={S.label}>Escola *</label>
        <input style={S.input} placeholder="Nome da escola" value={form.escola} onChange={set("escola")} />
        <label style={S.label}>Rede / MunicÃ­pio *</label>
        <input style={S.input} placeholder="Ex.: Porto Alegre/RS" value={form.rede} onChange={set("rede")} />
        <label style={S.label}>Tipo de avaliaÃ§Ã£o</label>
        <select style={S.input} value={form.tipo} onChange={set("tipo")}>
          <option value="AUTO">AutoavaliaÃ§Ã£o</option>
          <option value="360">AvaliaÃ§Ã£o 360 (por pares/supervisÃ£o)</option>
        </select>
        {err && <p style={{ color: "#c44", fontSize: 13, marginBottom: 10 }}>{err}</p>}
        <button style={S.btn} onClick={handleStart}>ComeÃ§ar a avaliaÃ§Ã£o â†’</button>
        <p style={{ fontSize: 12, color: "#b0aba6", textAlign: "center", marginTop: 14 }}>
          14 competÃªncias Â· ~10 minutos Â· seus dados ficam seguros
        </p>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELA DE PERGUNTAS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function QuestionScreen({ onFinish }) {
  const [current, setCurrent] = useState(0);
  const [answers, setAnswers] = useState({});
  const comp     = COMPETENCIES[current];
  const shuffled = useMemo(() => shuffle([0, 1, 2, 3]), [comp.id]);
  const progress = ((current + 1) / COMPETENCIES.length) * 100;

  const choose = (idx) => {
    const newAns = { ...answers, [comp.id]: idx };
    setAnswers(newAns);
    setTimeout(() => {
      if (current < COMPETENCIES.length - 1) setCurrent(current + 1);
      else onFinish(newAns);
    }, 180);
  };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <div style={{ marginBottom: 16 }}>
          <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, color: "#b0aba6", marginBottom: 6 }}>
            <span>{current + 1} de {COMPETENCIES.length}</span>
            <span>{Math.round(progress)}%</span>
          </div>
          <div style={{ background: "#f0ede8", borderRadius: 6, height: 5, overflow: "hidden" }}>
            <div style={{ width: `${progress}%`, height: "100%", background: DIM_COLORS[comp.dimension], transition: "width 0.4s ease", borderRadius: 6 }} />
          </div>
        </div>
        <div style={S.tag(DIM_COLORS[comp.dimension])}>{comp.dimension} Â· {comp.dimensionName}</div>
        <h2 style={{ ...S.h2, marginBottom: 6 }}>{comp.name}</h2>
        <p style={{ fontSize: 13, color: "#b0aba6", marginBottom: 20 }}>Escolha o descritor que melhor representa sua prÃ¡tica atual.</p>
        <div style={{ display: "flex", flexDirection: "column", gap: 10 }}>
          {shuffled.map((lvlIdx) => {
            const isSelected = answers[comp.id] === lvlIdx;
            return (
              <button key={lvlIdx} onClick={() => choose(lvlIdx)} style={{
                display: "flex", gap: 12, alignItems: "flex-start", textAlign: "left",
                padding: "14px 16px", borderRadius: 12, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                border: isSelected ? `2px solid ${DIM_COLORS[comp.dimension]}` : "1.5px solid #e8e4df",
                background: isSelected ? DIM_COLORS[comp.dimension] + "11" : "#fff",
                transition: "all 0.15s",
              }}>
                <span style={{ fontWeight: 700, fontSize: 12, color: DIM_COLORS[comp.dimension], flexShrink: 0, marginTop: 2, minWidth: 18 }}>
                  {lvlIdx + 1}
                </span>
                <span style={{ fontSize: 14, color: "#4a4540", lineHeight: 1.6 }}>{comp.levels[lvlIdx]}</span>
              </button>
            );
          })}
        </div>
        {current > 0 && (
          <button style={S.btnGhost} onClick={() => setCurrent(current - 1)}>â† Voltar</button>
        )}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELA DE RESULTADOS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ResultsScreen({ answers, userData, onDecide }) {
  const { dims, imle } = useMemo(() => calcResults(answers), [answers]);
  const contradictions = useMemo(() => detectContradictions(answers), [answers]);
  const interpretation = getImleInterpretation(imle);

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <div style={{ textAlign: "center", marginBottom: 20 }}>
          <div style={{ fontSize: 36, marginBottom: 4 }}>ğŸ§­</div>
          <h2 style={S.h2}>Seu resultado</h2>
          <p style={{ fontSize: 13, color: "#8a8580" }}>{userData.nome} Â· {userData.escola}</p>
        </div>
        <div style={{ ...S.infoBox("#fdf9f4", "#e8dfd0"), textAlign: "center", marginBottom: 16 }}>
          <p style={{ fontSize: 11, fontWeight: 700, letterSpacing: 1.5, textTransform: "uppercase", color: "#c4955a", marginBottom: 4 }}>
            IMLE â€” Ãndice de Maturidade de LideranÃ§a Escolar
          </p>
          <div style={{ fontSize: 38, fontWeight: 700, color: "#2d2926", fontFamily: "'DM Serif Display', serif", lineHeight: 1 }}>
            {imle.toFixed(1)}{" "}
            <span style={{ fontSize: 18, color: "#b0aba6", fontFamily: "'DM Sans', sans-serif", fontWeight: 400 }}>/ 4,0</span>
          </div>
          {CONFIG.SHOW_IMLE_BANDS && <div style={{ marginTop: 6 }}><span style={S.tag("#c4955a")}>{interpretation.label}</span></div>}
          <p style={{ fontSize: 13, color: "#6a6560", marginTop: 8, lineHeight: 1.55 }}>
            {CONFIG.SHOW_IMLE_BANDS ? interpretation.desc
              : imle >= 3.3 ? "VocÃª estÃ¡ num patamar avanÃ§ado de lideranÃ§a. HÃ¡ espaÃ§o para se tornar referÃªncia sistÃªmica."
              : imle >= 2.6 ? "VocÃª demonstra prÃ¡ticas consistentes e tem espaÃ§o claro para aprofundar sua lideranÃ§a."
              : imle >= 1.6 ? "VocÃª estÃ¡ em desenvolvimento e jÃ¡ acumulou experiÃªncias valiosas. Foco em algumas competÃªncias pode acelerar seu crescimento."
              : "VocÃª estÃ¡ nas etapas iniciais dessas competÃªncias â€” um bom ponto de partida para um plano de desenvolvimento focado."}
          </p>
        </div>
        <div style={{ marginBottom: 16 }}><RadarChart dims={dims} /></div>
        {DIMENSIONS.map((d) => {
          const comps = COMPETENCIES.filter((c) => c.dimension === d);
          return (
            <div key={d} style={{ marginBottom: 20 }}>
              <div style={{ display: "flex", alignItems: "center", gap: 8, marginBottom: 8 }}>
                <span style={S.tag(DIM_COLORS[d])}>{d}</span>
                <span style={{ fontWeight: 600, fontSize: 14, color: "#2d2926" }}>{DIM_LABELS[d]}</span>
                <span style={{ marginLeft: "auto", fontSize: 13, fontWeight: 700, color: DIM_COLORS[d] }}>{(dims[d] || 0).toFixed(1)}</span>
              </div>
              {comps.map((c) => {
                const v   = answers[c.id] ?? -1;
                const pct = v >= 0 ? ((v + 1) / 4) * 100 : 0;
                return (
                  <div key={c.id} style={{ marginBottom: 8 }}>
                    <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, color: "#6a6560", marginBottom: 3 }}>
                      <span>{c.id} Â· {c.name}</span>
                      <span style={{ fontWeight: 600, flexShrink: 0, marginLeft: 8 }}>{v >= 0 ? LEVEL_LABELS[v] : "â€”"}</span>
                    </div>
                    <div style={S.barWrap}><div style={S.bar(pct, DIM_COLORS[d])} /></div>
                  </div>
                );
              })}
            </div>
          );
        })}
        {contradictions.length > 0 && (
          <div style={{ marginTop: 8 }}>
            <p style={{ fontSize: 13, fontWeight: 700, color: "#b07a3a", marginBottom: 8 }}>ğŸ’¡ Pontos para reflexÃ£o</p>
            {contradictions.map((msg, i) => (
              <div key={i} style={S.infoBox("#fff9f0", "#f0d9a8")}>
                <p style={{ fontSize: 13, color: "#7a5a2a", lineHeight: 1.6, margin: 0 }}>{msg}</p>
              </div>
            ))}
          </div>
        )}
        <button style={{ ...S.btn, marginTop: 20 }} onClick={onDecide}>Escolher minha competÃªncia-foco â†’</button>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELA DE DECISÃ•ES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function DecisionScreen({ answers, userData, results, onConfirm }) {
  const [focus,      setFocus]      = useState(null);
  const [mentor,     setMentor]     = useState(null);
  const [mentorComp, setMentorComp] = useState(null);
  const [err,        setErr]        = useState("");

  const lowComps  = COMPETENCIES.filter((c) => (answers[c.id] ?? -1) <= 1);
  const highComps = COMPETENCIES.filter((c) => (answers[c.id] ?? -1) >= 2);

  const handleConfirm = () => {
    if (!focus)                { setErr("Escolha uma competÃªncia-foco para continuar."); return; }
    if (mentor === null)       { setErr("Indique se deseja ser mentor(a)."); return; }
    if (mentor && !mentorComp) { setErr("Escolha a competÃªncia em que vocÃª vai oferecer mentoria."); return; }
    setErr("");
    onConfirm({
      focus, mentor, mentorComp,
      linkFocus:     buildCompLink(focus),
      linkMentor:    mentor && mentorComp ? buildCompLink(mentorComp) : "",
      linkPortfolio: buildPortfolioLink(userData.email),
    });
  };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <h2 style={S.h2}>Suas decisÃµes de desenvolvimento</h2>
        <p style={S.sub}>Com base no que vocÃª respondeu, defina seu prÃ³ximo passo.</p>
        <div style={{ marginBottom: 24 }}>
          <p style={{ fontSize: 14, fontWeight: 600, color: "#2d2926", marginBottom: 4 }}>Qual competÃªncia vocÃª quer desenvolver primeiro? *</p>
          <p style={{ fontSize: 13, color: "#8a8580", marginBottom: 12 }}>
            {lowComps.length > 0 ? "Mostramos as competÃªncias onde hÃ¡ mais espaÃ§o de crescimento." : "VocÃª estÃ¡ bem em todas â€” escolha onde quer aprofundar ainda mais."}
          </p>
          <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
            {(lowComps.length > 0 ? lowComps : COMPETENCIES).map((c) => (
              <button key={c.id} onClick={() => setFocus(c.id)} style={{
                display: "flex", gap: 10, alignItems: "center", textAlign: "left",
                padding: "12px 14px", borderRadius: 10, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                border: focus === c.id ? `2px solid ${DIM_COLORS[c.dimension]}` : "1.5px solid #e8e4df",
                background: focus === c.id ? DIM_COLORS[c.dimension] + "11" : "#fff",
                transition: "all 0.15s",
              }}>
                <span style={{ ...S.tag(DIM_COLORS[c.dimension]), margin: 0, flexShrink: 0 }}>{c.id}</span>
                <span style={{ fontSize: 13, color: "#4a4540", lineHeight: 1.5 }}>
                  {c.name} <span style={{ color: "#b0aba6", marginLeft: 4 }}>({LEVEL_LABELS[answers[c.id] ?? 0]})</span>
                </span>
              </button>
            ))}
          </div>
        </div>
        <div style={{ marginBottom: 24 }}>
          <p style={{ fontSize: 14, fontWeight: 600, color: "#2d2926", marginBottom: 4 }}>VocÃª quer se candidatar a mentor(a)? *</p>
          <p style={{ fontSize: 13, color: "#8a8580", marginBottom: 12 }}>Gestores com nÃ­vel AvanÃ§ado ou ReferÃªncia em alguma competÃªncia podem apoiar colegas.</p>
          <div style={{ display: "flex", gap: 10 }}>
            {["Sim", "NÃ£o"].map((opt) => {
              const val = opt === "Sim";
              return (
                <button key={opt} onClick={() => { setMentor(val); if (!val) setMentorComp(null); }} style={{
                  flex: 1, padding: "11px", borderRadius: 10, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                  fontWeight: 600, fontSize: 14,
                  border: mentor === val ? "2px solid #c4955a" : "1.5px solid #e8e4df",
                  background: mentor === val ? "#c4955a11" : "#fff",
                  color: mentor === val ? "#c4955a" : "#6a6560",
                  transition: "all 0.15s",
                }}>{opt}</button>
              );
            })}
          </div>
          {mentor === true && (
            <div style={{ marginTop: 14 }}>
              <p style={{ fontSize: 13, fontWeight: 600, color: "#5a5550", marginBottom: 8 }}>Em qual competÃªncia vocÃª vai oferecer mentoria? *</p>
              <div style={{ display: "flex", flexDirection: "column", gap: 8 }}>
                {(highComps.length > 0 ? highComps : COMPETENCIES).map((c) => (
                  <button key={c.id} onClick={() => setMentorComp(c.id)} style={{
                    display: "flex", gap: 10, alignItems: "center", textAlign: "left",
                    padding: "11px 14px", borderRadius: 10, cursor: "pointer", fontFamily: "'DM Sans', sans-serif",
                    border: mentorComp === c.id ? `2px solid ${DIM_COLORS[c.dimension]}` : "1.5px solid #e8e4df",
                    background: mentorComp === c.id ? DIM_COLORS[c.dimension] + "11" : "#fff",
                    transition: "all 0.15s",
                  }}>
                    <span style={{ ...S.tag(DIM_COLORS[c.dimension]), margin: 0, flexShrink: 0 }}>{c.id}</span>
                    <span style={{ fontSize: 13, color: "#4a4540" }}>
                      {c.name} <span style={{ color: "#b0aba6", marginLeft: 4 }}>({LEVEL_LABELS[answers[c.id] ?? 0]})</span>
                    </span>
                  </button>
                ))}
              </div>
            </div>
          )}
        </div>
        {err && <p style={{ color: "#c44", fontSize: 13, marginBottom: 10 }}>{err}</p>}
        <button style={S.btn} onClick={handleConfirm}>Confirmar e enviar â†’</button>
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TELA DE CONFIRMAÃ‡ÃƒO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function ConfirmationScreen({ userData, answers, results, decisions }) {
  const { imle, dims } = results;
  const [status,  setStatus] = useState("idle");
  const [errMsg,  setErrMsg] = useState("");
  const submittedRef = useRef(false);

  const buildPayload = () => ({
    submission_id:             generateSubmissionId(),
    app_version:               CONFIG.APP_VERSION,
    ciclo_projeto:             CONFIG.CICLO_PROJETO,
    nome:                      userData.nome,
    email:                     normalizeEmail(userData.email),
    escola:                    userData.escola,
    rede:                      userData.rede,
    tipo_avaliacao:            userData.tipo,
    data_avaliacao:            new Date().toISOString().slice(0, 10),
    media_P1:                  parseFloat(dims.P1.toFixed(2)),
    media_P2:                  parseFloat(dims.P2.toFixed(2)),
    media_P3:                  parseFloat(dims.P3.toFixed(2)),
    IMLE:                      parseFloat(imle.toFixed(2)),
    competencia_foco:          decisions.focus,
    quer_ser_mentor:           decisions.mentor,
    competencia_mentoria:      decisions.mentorComp || "",
    link_competencia_foco:     decisions.linkFocus,
    link_competencia_mentoria: decisions.linkMentor,
    link_portfolio:            decisions.linkPortfolio,
    answers_json:              JSON.stringify(answers),
  });

  const doSubmit = async () => {
    if (submittedRef.current) return;
    submittedRef.current = true;
    setStatus("sending");
    const payload = buildPayload();
    try {
      await submitToSheets(payload);
      localStorage.removeItem("pending_submission");
      setStatus("success");
    } catch (e) {
      submittedRef.current = false;
      setErrMsg("NÃ£o foi possÃ­vel enviar agora. Suas respostas foram salvas neste dispositivo.");
      localStorage.setItem("pending_submission", JSON.stringify(payload));
      setStatus("error");
    }
  };

  const retry = () => { submittedRef.current = false; doSubmit(); };

  return (
    <div style={S.wrap} className="fade-in">
      <div style={S.card}>
        <div style={{ textAlign: "center", marginBottom: 20 }}>
          <div style={{ fontSize: 40, marginBottom: 8 }}>
            {status === "success" ? "âœ…" : status === "error" ? "âš ï¸" : status === "sending" ? "â³" : "ğŸ“‹"}
          </div>
          <h2 style={S.h2}>
            {status === "success" ? "Enviado com sucesso!" : status === "error" ? "Erro no envio" : status === "sending" ? "Enviandoâ€¦" : "Resumo da sua avaliaÃ§Ã£o"}
          </h2>
        </div>
        <div style={S.infoBox("#f5f8ff", "#d0daf0")}>
          <p style={{ fontSize: 13, color: "#4a4560", lineHeight: 1.7, margin: 0 }}>
            <strong>IMLE:</strong> {imle.toFixed(1)} / 4,0<br />
            <strong>P1:</strong> {dims.P1.toFixed(1)} Â· <strong>P2:</strong> {dims.P2.toFixed(1)} Â· <strong>P3:</strong> {dims.P3.toFixed(1)}<br />
            <strong>CompetÃªncia-foco:</strong> {decisions.focus} Â· {COMPETENCIES.find(c => c.id === decisions.focus)?.name}<br />
            {decisions.mentor && <><strong>Mentoria em:</strong> {decisions.mentorComp} Â· {COMPETENCIES.find(c => c.id === decisions.mentorComp)?.name}<br /></>}
            <strong>Ciclo:</strong> {CONFIG.CICLO_PROJETO} Â· <strong>Tipo:</strong> {userData.tipo === "AUTO" ? "AutoavaliaÃ§Ã£o" : "AvaliaÃ§Ã£o 360"}
          </p>
        </div>
        <div style={{ marginTop: 16, marginBottom: 8 }}>
          <p style={{ fontSize: 13, fontWeight: 600, color: "#5a5550", marginBottom: 10 }}>Seus materiais de desenvolvimento:</p>
          <a href={decisions.linkFocus} target="_blank" rel="noreferrer" style={{
            display: "block", padding: "12px 16px", borderRadius: 10, background: "#c4955a", color: "#fff",
            textDecoration: "none", fontSize: 13, fontWeight: 600, marginBottom: 8, textAlign: "center",
          }}>ğŸ“˜ Unidade digital: CompetÃªncia {decisions.focus}</a>
          {decisions.mentor && decisions.mentorComp && (
            <a href={decisions.linkMentor} target="_blank" rel="noreferrer" style={{
              display: "block", padding: "12px 16px", borderRadius: 10, background: "#6dab8c", color: "#fff",
              textDecoration: "none", fontSize: 13, fontWeight: 600, marginBottom: 8, textAlign: "center",
            }}>ğŸ¤ CompetÃªncia de mentoria: {decisions.mentorComp}</a>
          )}
          <a href={decisions.linkPortfolio} target="_blank" rel="noreferrer" style={{
            display: "block", padding: "12px 16px", borderRadius: 10, border: "1.5px solid #e0ddd8",
            color: "#5a7ec4", textDecoration: "none", fontSize: 13, fontWeight: 600, textAlign: "center",
          }}>ğŸ—‚ï¸ Meu portfÃ³lio digital</a>
        </div>
        {status === "idle" && (
          <button style={{ ...S.btn, marginTop: 12 }} onClick={doSubmit}>Confirmar e registrar minha avaliaÃ§Ã£o</button>
        )}
        {status === "sending" && (
          <button style={{ ...S.btn, marginTop: 12, opacity: 0.6, cursor: "not-allowed" }} disabled>Enviandoâ€¦</button>
        )}
        {status === "error" && (
          <div style={{ marginTop: 12 }}>
            <div style={S.infoBox("#fff5f5", "#f0c0c0")}>
              <p style={{ fontSize: 13, color: "#c04040", margin: 0 }}>{errMsg}</p>
            </div>
            <button style={S.btn} onClick={retry}>Tentar novamente</button>
          </div>
        )}
        {status === "success" && (
          <div style={S.infoBox("#f0fff8", "#a0e0c0")}>
            <p style={{ fontSize: 13, color: "#2a7a50", margin: 0, lineHeight: 1.6 }}>
              âœ“ Suas respostas foram registradas. A prÃ³xima avaliaÃ§Ã£o sugerida Ã© em 3 meses (ciclo {CONFIG.CICLO_PROJETO}).
            </p>
          </div>
        )}
      </div>
    </div>
  );
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// APP PRINCIPAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function App() {
  const [screen,      setScreen]      = useState("welcome");
  const [userData,    setUserData]    = useState(null);
  const [answers,     setAnswers]     = useState({});
  const [results,     setResults]     = useState(null);
  const [decisions,   setDecisions]   = useState(null);
  const [showPending, setShowPending] = useState(false);

  useEffect(() => {
    if (localStorage.getItem("pending_submission")) setShowPending(true);
  }, []);

  const handleStart = (form) => { setUserData(form); setScreen("questions"); };
  const handleFinishQuestions = (ans) => { setAnswers(ans); setResults(calcResults(ans)); setScreen("results"); };
  const handleDecide = (dec) => { setDecisions(dec); setScreen("confirmation"); };

  return (
    <>
      {showPending && <PendingBanner onDismiss={() => setShowPending(false)} />}
      <div style={showPending ? { paddingTop: 60 } : {}}>
        {screen === "welcome"      && <WelcomeScreen onStart={handleStart} />}
        {screen === "questions"    && <QuestionScreen onFinish={handleFinishQuestions} />}
        {screen === "results"      && <ResultsScreen answers={answers} userData={userData} results={results} onDecide={() => setScreen("decisions")} />}
        {screen === "decisions"    && <DecisionScreen answers={answers} userData={userData} results={results} onConfirm={handleDecide} />}
        {screen === "confirmation" && <ConfirmationScreen userData={userData} answers={answers} results={results} decisions={decisions} />}
      </div>
    </>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
